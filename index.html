<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dig Deep - Mining Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.5s;
        }

        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.8);
            padding: 15px 25px;
            border-radius: 15px;
            margin-bottom: 15px;
            color: white;
            flex-wrap: nowrap;
            gap: 10px;
        }

        .money-display {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .rebirth-display {
            font-size: 18px;
            color: #ff69b4;
            margin-top: 5px;
        }

        .world-display {
            font-size: 16px;
            color: #7fffd4;
            margin-top: 3px;
        }

        .depth-display {
            font-size: 16px;
            color: #aaa;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: nowrap;
        }

        .shop-btn, .rebirth-btn, .worlds-btn {
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .shop-btn {
            background: linear-gradient(145deg, #ff6b35, #f7931e);
            box-shadow: 0 4px 15px rgba(255,107,53,0.4);
        }

        .rebirth-btn {
            background: linear-gradient(145deg, #ff1493, #c71585);
            box-shadow: 0 4px 15px rgba(255,20,147,0.4);
        }

        .worlds-btn {
            background: linear-gradient(145deg, #20b2aa, #008b8b);
            box-shadow: 0 4px 15px rgba(32,178,170,0.4);
        }

        .shop-btn:hover, .rebirth-btn:hover, .worlds-btn:hover {
            transform: scale(1.05);
        }

        .mining-area {
            position: relative;
            height: 450px;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            border: 4px solid #2d1f14;
            transition: background 0.5s;
        }

        .surface-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 25px;
            background: linear-gradient(180deg, #228b22 0%, #32cd32 40%, #556b2f 70%, #8b4513 100%);
            z-index: 5;
            border-bottom: 3px solid #3d2817;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: background 0.5s;
        }

        .surface-emoji {
            position: absolute;
            top: -8px;
            left: 0;
            width: 100%;
            font-size: 12px;
            letter-spacing: 8px;
            text-align: center;
            pointer-events: none;
        }

        .dirt-layer {
            position: absolute;
            width: 100%;
            height: calc(100% - 25px);
            top: 25px;
        }

        .ore {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 11px;
            animation: sparkle 2s infinite;
            cursor: pointer;
            transition: filter 0.1s;
            width: 45px;
            height: 45px;
            /* Highly irregular rocky shape for natural appearance */
            clip-path: polygon(
                20% 0%, 40% 5%, 60% 0%, 75% 10%, 85% 25%, 95% 40%, 100% 55%, 98% 70%, 90% 80%, 75% 90%, 
                55% 95%, 35% 98%, 20% 95%, 10% 85%, 5% 70%, 0% 55%, 2% 40%, 8% 25%, 15% 10%
            );
            /* 3D rocky effect with radial gradient base + multiple shadows */
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), rgba(0,0,0,0.3) 70%);
            background-attachment: fixed;
            box-shadow: 
                /* Deep shadows for depth */
                inset -4px -4px 8px rgba(0,0,0,0.6),
                inset 3px 3px 6px rgba(255,255,255,0.2),
                inset -2px -2px 4px rgba(0,0,0,0.4),
                /* Outer shadow for separation */
                0 4px 12px rgba(0,0,0,0.4),
                0 2px 6px rgba(0,0,0,0.3);
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.3));
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .ore::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            clip-path: inherit;
            background: radial-gradient(ellipse at 35% 25%, rgba(255,255,255,0.15), transparent 50%);
            pointer-events: none;
        }

        .ore::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            clip-path: inherit;
            background: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 2px,
                    rgba(0,0,0,0.05) 2px,
                    rgba(0,0,0,0.05) 4px
                );
            pointer-events: none;
        }

        .ore:hover {
            filter: brightness(1.2);
            box-shadow: 0 0 15px currentColor, inset -2px -2px 4px rgba(0,0,0,0.4), inset 2px 2px 4px rgba(255,255,255,0.3);
        }

        @keyframes sparkle {
            0%, 100% { box-shadow: 0 0 5px currentColor; }
            50% { box-shadow: 0 0 15px currentColor, 0 0 25px currentColor; }
        }

        .shovel {
            position: absolute;
            font-size: 70px;
            cursor: pointer;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5));
            z-index: 10;
            pointer-events: none;
            transition: none;
        }

        .shovel.digging {
            transform: rotate(-30deg) scale(0.9);
        }

        .money-popup {
            position: absolute;
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            z-index: 100;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-80px); }
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

            #menu-settings-modal {
                z-index: 3500;
            }

        .modal-content {
            background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
            border-radius: 20px;
            padding: 25px;
            max-width: 550px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            border: 3px solid #ffd700;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 28px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .close-btn {
            background: #ff4444;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 20px;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .close-btn:hover {
            transform: scale(1.1);
        }

        .upgrade-item, .world-item {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .upgrade-item:hover, .world-item:hover {
            border-color: #ffd700;
        }

        .upgrade-info h3, .world-info h3 {
            color: white;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .upgrade-info p, .world-info p {
            color: #aaa;
            font-size: 13px;
        }

        .upgrade-info .level {
            color: #4ecdc4;
            font-size: 11px;
            margin-top: 4px;
        }

        .buy-btn {
            background: linear-gradient(145deg, #4ecdc4, #44a3a0);
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-weight: bold;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.3s;
            white-space: nowrap;
        }

        .buy-btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .buy-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .buy-btn.locked {
            background: linear-gradient(145deg, #666, #444);
        }

        .buy-btn.current {
            background: linear-gradient(145deg, #32cd32, #228b22);
        }

        .stats-bar {
            display: flex;
            gap: 15px;
            background: rgba(0,0,0,0.6);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .stat {
            color: white;
            font-size: 13px;
        }

        .stat-value {
            color: #4ecdc4;
            font-weight: bold;
        }

        .ore-legend {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 12px;
            padding: 12px;
            background: rgba(0,0,0,0.6);
            border-radius: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .ore-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: white;
            font-size: 11px;
        }

        .ore-sample {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .instructions {
            text-align: center;
            color: rgba(255,255,255,0.7);
            margin-top: 12px;
            font-size: 14px;
        }

        .rebirth-info {
            background: rgba(255,20,147,0.2);
            border: 2px solid #ff69b4;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .rebirth-info h3 {
            color: #ff69b4;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .rebirth-info p {
            color: #ddd;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .rebirth-cost {
            color: #ffd700;
            font-size: 18px;
            font-weight: bold;
        }

        .section-title {
            color: #ffd700;
            font-size: 18px;
            margin: 20px 0 10px 0;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 5px;
        }

        .world-locked {
            opacity: 0.6;
        }

        /* Skill Tree Styles */
        .skill-tree-btn {
            background: linear-gradient(145deg, #9b59b6, #8e44ad);
            box-shadow: 0 4px 15px rgba(155,89,182,0.4);
        }

        .skill-tree-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .skill-points-display {
            text-align: center;
            background: rgba(155,89,182,0.3);
            padding: 15px;
            border-radius: 10px;
            color: #ffd700;
            font-size: 18px;
            font-weight: bold;
        }

        .path-selection {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .path-card {
            background: rgba(30,30,50,0.9);
            border: 3px solid #444;
            border-radius: 15px;
            padding: 20px;
            width: 180px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .path-card:hover:not(.locked):not(.not-chosen) {
            transform: scale(1.05);
            border-color: #9b59b6;
        }

        .path-card.active {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255,215,0,0.5);
        }

        .path-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .path-card.not-chosen {
            display: none;
        }

        .path-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .path-name {
            color: white;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .path-desc {
            color: #aaa;
            font-size: 12px;
        }

        .path-level {
            color: #ffd700;
            font-size: 14px;
            margin-top: 10px;
        }

        .upgrade-choices {
            display: none;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #444;
        }

        .upgrade-choices.visible {
            display: flex;
        }

        .upgrade-choices h3 {
            color: #ffd700;
            text-align: center;
            margin-bottom: 10px;
        }

        .choice-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .choice-card {
            background: rgba(50,50,80,0.9);
            border: 2px solid #666;
            border-radius: 12px;
            padding: 15px;
            width: 160px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .choice-card:hover:not(.locked) {
            transform: scale(1.05);
            border-color: #9b59b6;
        }

        .choice-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .choice-card.owned {
            border-color: #27ae60;
            background: rgba(39,174,96,0.2);
        }

        .choice-icon {
            font-size: 30px;
            margin-bottom: 8px;
        }

        .choice-name {
            color: white;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .choice-effect {
            color: #7bed9f;
            font-size: 11px;
            margin-bottom: 8px;
        }

        .choice-cost {
            color: #ffd700;
            font-size: 12px;
            font-weight: bold;
        }

        .skill-tree-progress {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        .tier-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #333;
            border: 2px solid #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #888;
        }

        .tier-dot.unlocked {
            background: #9b59b6;
            border-color: #e0aaff;
            color: white;
        }

        .tier-dot.current {
            background: #ffd700;
            border-color: #fff;
            color: #000;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }


        /* Worker Styles */
        .worker {
            position: absolute;
            width: 30px;
            height: 45px;
            z-index: 20;
            pointer-events: none;
            transition: none;
        }
        .worker-body {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .worker-head {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 16px;
            background: #ffdbac;
            border-radius: 50%;
            border: 2px solid #d4a574;
        }
        .worker-torso {
            position: absolute;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            width: 14px;
            height: 14px;
            background: #3498db;
            border-radius: 3px;
        }
        .worker-leg {
            position: absolute;
            bottom: 0;
            width: 6px;
            height: 15px;
            background: #2c3e50;
            border-radius: 2px;
        }
        .worker-leg.left { left: 6px; }
        .worker-leg.right { right: 6px; }
        .worker-arm {
            position: absolute;
            top: 18px;
            width: 5px;
            height: 12px;
            background: #ffdbac;
            border-radius: 2px;
            transform-origin: top center;
        }
        .worker-arm.left { left: 2px; }
        .worker-arm.right { right: 2px; }
        .worker-pickaxe {
            position: absolute;
            top: 12px;
            right: -8px;
            font-size: 14px;
            transform: rotate(-45deg);
        }
        /* Walking animation */
        .worker.walking .worker-leg.left {
            animation: walkLeft 0.4s ease-in-out infinite;
        }
        .worker.walking .worker-leg.right {
            animation: walkRight 0.4s ease-in-out infinite;
        }
        .worker.walking .worker-arm.left {
            animation: armSwingLeft 0.4s ease-in-out infinite;
        }
        .worker.walking .worker-arm.right {
            animation: armSwingRight 0.4s ease-in-out infinite;
        }
        .worker.walking .worker-body {
            animation: workerBob 0.2s ease-in-out infinite;
        }
        @keyframes walkLeft {
            0%, 100% { transform: rotate(-25deg); }
            50% { transform: rotate(25deg); }
        }
        @keyframes walkRight {
            0%, 100% { transform: rotate(25deg); }
            50% { transform: rotate(-25deg); }
        }
        @keyframes armSwingLeft {
            0%, 100% { transform: rotate(20deg); }
            50% { transform: rotate(-20deg); }
        }
        @keyframes armSwingRight {
            0%, 100% { transform: rotate(-20deg); }
            50% { transform: rotate(20deg); }
        }
        @keyframes workerBob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-2px); }
        }
        /* Mining animation */
        .worker.mining .worker-pickaxe {
            animation: miningSwing 0.5s ease-in-out infinite;
        }
        @keyframes miningSwing {
            0%, 100% { transform: rotate(-45deg); }
            50% { transform: rotate(-90deg) translateX(-5px); }
        }
        /* Hakari Special Worker */
        .worker.hakari {
            filter: drop-shadow(0 0 8px gold) drop-shadow(0 0 15px #9b59b6);
        }
        .worker.hakari .worker-head {
            background: #ffdbac !important;
            border-color: #d4a574 !important;
            position: relative;
        }
        .worker.hakari .worker-head::after {
            content: '';
            position: absolute;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 14px;
            height: 10px;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            border-radius: 8px 8px 0 0;
            z-index: 31;
        }
        .worker.hakari .worker-torso {
            background: linear-gradient(135deg, #9b59b6, #e74c3c) !important;
        }
        .worker.hakari::before {
            content: 'üëë';
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            z-index: 32;
        }
        .worker.hakari.casting {
            animation: none !important;
        }
        .worker.hakari.casting .worker-leg,
        .worker.hakari.casting .worker-arm {
            animation: none !important;
        }
        .worker.hakari.casting::after {
            content: 'üé∞';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            animation: domainCastGlow 0.5s ease-in-out infinite alternate;
        }
        @keyframes domainCastGlow {
            0% { filter: drop-shadow(0 0 5px gold); }
            100% { filter: drop-shadow(0 0 15px gold) drop-shadow(0 0 25px #9b59b6); }
        }
        @keyframes teleportFlash {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
        }
        /* The Strongest Worker - Gojo Style */
        .worker.strongest {
            filter: drop-shadow(0 0 12px #00bfff) drop-shadow(0 0 20px #1a1a2e);
        }
        .worker.strongest .worker-head {
            background: #ffdbac !important;
            border-color: #d4a574 !important;
            position: relative;
        }
        .worker.strongest .worker-head::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 4px;
            background: linear-gradient(90deg, #000 0%, #1a1a2e 50%, #000 100%);
            border-radius: 2px;
            z-index: 31;
        }
        .worker.strongest .worker-head::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 14px;
            height: 10px;
            background: linear-gradient(135deg, #ffffff, #e0e0e0);
            border-radius: 8px 8px 0 0;
            z-index: 31;
        }
        .worker.strongest .worker-torso {
            background: linear-gradient(135deg, #1a1a2e, #000000) !important;
        }
        .worker.strongest::before {
            content: '‚ôæÔ∏è';
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            z-index: 32;
        }
        .worker.strongest.casting {
            animation: infiniteVoidGlow 0.3s ease-in-out infinite alternate !important;
        }
        .worker.strongest.casting::after {
            content: 'üîµ';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            animation: infiniteVoidCast 0.5s ease-in-out infinite alternate;
        }
        @keyframes infiniteVoidGlow {
            0% { filter: drop-shadow(0 0 10px #00bfff); }
            100% { filter: drop-shadow(0 0 25px #00bfff) drop-shadow(0 0 40px #1a1a2e); }
        }
        @keyframes infiniteVoidCast {
            0% { filter: drop-shadow(0 0 5px #00bfff); transform: translateX(-50%) scale(1); }
            100% { filter: drop-shadow(0 0 20px #00bfff); transform: translateX(-50%) scale(1.3); }
        }
        /* Infinite Void Domain Effect */
        .domain-infinite-void {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0,0,0,0.9) 0%, rgba(26,26,46,0.7) 30%, rgba(0,191,255,0.3) 60%, transparent 80%);
            border: 3px solid #00bfff;
            pointer-events: none;
            z-index: 15;
            animation: infiniteVoidPulse 3s ease-out forwards;
        }
        @keyframes infiniteVoidPulse {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; box-shadow: inset 0 0 50px #00bfff; }
            30% { transform: translate(-50%, -50%) scale(1); opacity: 0.9; }
            70% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.7; }
            100% { transform: translate(-50%, -50%) scale(1.3); opacity: 0; }
        }
        /* Sukuna - The King of Curses */
        .worker.sukuna {
            filter: drop-shadow(0 0 15px #ff0000) drop-shadow(0 0 25px #8b0000);
        }
        .worker.sukuna .worker-head {
            background: #ffdbac !important;
            border-color: #8b0000 !important;
            position: relative;
        }
        .worker.sukuna .worker-head::after {
            content: '';
            position: absolute;
            top: 1px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 6px;
            background: linear-gradient(90deg, #8b0000 0%, #ff0000 50%, #8b0000 100%);
            border-radius: 2px;
            z-index: 31;
        }
        .worker.sukuna .worker-head::before {
            content: '';
            position: absolute;
            top: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 8px;
            background: linear-gradient(135deg, #1a1a1a, #000000);
            border-radius: 8px 8px 0 0;
            z-index: 31;
        }
        .worker.sukuna .worker-torso {
            background: linear-gradient(135deg, #1a1a1a, #8b0000) !important;
        }
        .worker.sukuna::before {
            content: 'üëπ';
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            z-index: 32;
        }
        .worker.sukuna.casting {
            animation: malevolentGlow 0.2s ease-in-out infinite alternate !important;
        }
        .worker.sukuna.casting::after {
            content: 'üî•';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            animation: malevolentCast 0.3s ease-in-out infinite alternate;
        }
        @keyframes malevolentGlow {
            0% { filter: drop-shadow(0 0 15px #ff0000); }
            100% { filter: drop-shadow(0 0 35px #ff0000) drop-shadow(0 0 50px #8b0000); }
        }
        @keyframes malevolentCast {
            0% { filter: drop-shadow(0 0 10px #ff0000); transform: translateX(-50%) scale(1); }
            100% { filter: drop-shadow(0 0 25px #ff4500); transform: translateX(-50%) scale(1.5); }
        }
        /* Malevolent Shrine Domain Effect */
        .domain-malevolent-shrine {
            position: absolute;
            left: 0 !important;
            top: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background: radial-gradient(circle, rgba(139,0,0,0.8) 0%, rgba(255,0,0,0.5) 30%, rgba(0,0,0,0.9) 70%, rgba(0,0,0,1) 100%);
            border: none;
            pointer-events: none;
            z-index: 15;
            animation: malevolentShrinePulse 4s ease-out forwards;
        }
        @keyframes malevolentShrinePulse {
            0% { opacity: 0; }
            10% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
        /* Domain Expansion Effect */
        .domain-expansion {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,215,0,0.3) 0%, rgba(255,215,0,0.1) 50%, transparent 70%);
            border: 3px solid gold;
            pointer-events: none;
            z-index: 15;
            animation: domainPulse 2s ease-out forwards;
        }
        @keyframes domainPulse {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(1.2); opacity: 0; }
        }
        .domain-text {
            position: absolute;
            color: gold;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 2px 2px 4px #9b59b6, -2px -2px 4px #9b59b6;
            pointer-events: none;
            z-index: 200;
            animation: domainTextAnim 3s ease-out forwards;
            white-space: nowrap;
        }
        @keyframes domainTextAnim {
            0% { opacity: 0; transform: translateX(-50%) translateY(0) scale(0.5); }
            20% { opacity: 1; transform: translateX(-50%) translateY(-20px) scale(1.2); }
            80% { opacity: 1; transform: translateX(-50%) translateY(-30px) scale(1); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-50px) scale(0.8); }
        }
        .workers-btn {
            background: linear-gradient(145deg, #9b59b6, #8e44ad);
            box-shadow: 0 4px 15px rgba(155,89,182,0.4);
        }
        .save-btn {
            background: linear-gradient(145deg, #27ae60, #229954);
            box-shadow: 0 4px 15px rgba(39,174,96,0.4);
            padding: 8px 12px !important;
            font-size: 12px !important;
        }
        .load-btn {
            background: linear-gradient(145deg, #3498db, #2980b9);
            box-shadow: 0 4px 15px rgba(52,152,219,0.4);
            padding: 8px 12px !important;
            font-size: 12px !important;
        }
        /* Admin Panel Styles */
        .admin-btn {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            border: none;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(231,76,60,0.4);
        }
        .admin-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(231,76,60,0.6);
        }
        .admin-btn.active {
            background: linear-gradient(145deg, #27ae60, #229954);
            box-shadow: 0 4px 15px rgba(39,174,96,0.4);
        }
        .settings-btn {
            background: linear-gradient(145deg, #6c757d, #5a6268);
            box-shadow: 0 4px 15px rgba(108,117,125,0.4);
        }
        .settings-section {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .settings-section h3 {
            color: #ffd700;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .admin-code-input {
            background: #1a1a1a;
            border: 2px solid #444;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 18px;
            color: white;
            text-align: center;
            letter-spacing: 8px;
            width: 100%;
            margin-bottom: 10px;
        }
        .admin-code-input:focus {
            outline: none;
            border-color: #e74c3c;
        }

        /* Lore Screen Styles */
        .lore-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #000 100%);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow: hidden;
        }

        .lore-screen.active {
            display: flex;
        }

        .lore-container {
            text-align: center;
            max-width: 800px;
            padding: 40px;
            animation: fadeInLore 1s ease-in;
        }

        @keyframes fadeInLore {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .lore-title {
            font-size: 48px;
            font-weight: bold;
            color: #ff6b6b;
            text-shadow: 0 0 20px #ff6b6b, 0 0 40px #8b0000;
            margin-bottom: 30px;
            letter-spacing: 3px;
            animation: glowPulse 3s infinite;
        }

        @keyframes glowPulse {
            0%, 100% {
                text-shadow: 0 0 20px #ff6b6b, 0 0 40px #8b0000;
            }
            50% {
                text-shadow: 0 0 30px #ff6b6b, 0 0 60px #ff0000, 0 0 80px #8b0000;
            }
        }

        .lore-text {
            font-size: 16px;
            color: #ccc;
            line-height: 1.8;
            margin-bottom: 20px;
            letter-spacing: 1px;
            opacity: 0;
            animation: typeWrite 4s ease-in forwards;
        }

        .lore-text:nth-child(2) {
            animation-delay: 0.5s;
        }

        .lore-text:nth-child(3) {
            animation-delay: 1s;
        }

        .lore-text:nth-child(4) {
            animation-delay: 1.5s;
        }

        @keyframes typeWrite {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .lore-highlight {
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 10px #ffd700;
        }

        .lore-dark {
            color: #ff6b6b;
            font-weight: bold;
        }

            .lore-buttons {
                display: flex;
                gap: 12px;
                justify-content: center;
                flex-wrap: wrap;
            }

        .lore-skip-btn {
            margin-top: 40px;
            padding: 12px 30px;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #ffd700;
            color: #ffd700;
            font-size: 14px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            animation: fadeInButton 3s ease-in forwards;
            opacity: 0;
        }

            .lore-settings-btn {
                margin-top: 40px;
                padding: 12px 30px;
                background: rgba(108, 117, 125, 0.15);
                border: 2px solid #6c757d;
                color: #d0d0d0;
                font-size: 14px;
                cursor: pointer;
                border-radius: 5px;
                transition: all 0.3s;
                animation: fadeInButton 3s ease-in forwards;
                opacity: 0;
            }

        @keyframes fadeInButton {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .lore-skip-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            box-shadow: 0 0 15px #ffd700;
        }

            .lore-settings-btn:hover {
                background: rgba(108, 117, 125, 0.25);
                box-shadow: 0 0 15px rgba(108, 117, 125, 0.6);
            }

        /* Main Menu Styles */
        .main-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .main-menu.active {
            display: flex;
        }

        .menu-container {
            text-align: center;
            background: rgba(0,0,0,0.7);
            padding: 40px;
            border-radius: 25px;
            border: 3px solid #ffd700;
            max-width: 600px;
            width: 95%;
            box-shadow: 0 0 40px rgba(255,215,0,0.3);
        }

        .menu-title {
            font-size: 48px;
            color: #ffd700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            margin-bottom: 10px;
            font-weight: bold;
        }

        .menu-subtitle {
            font-size: 16px;
            color: #aaa;
            margin-bottom: 30px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .menu-btn {
            background: linear-gradient(145deg, #ff6b35, #f7931e);
            border: none;
            padding: 16px 30px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255,107,53,0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .menu-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255,107,53,0.6);
        }

        .menu-btn.secondary {
            background: linear-gradient(145deg, #4ecdc4, #44a3a0);
            box-shadow: 0 4px 15px rgba(78,205,196,0.4);
        }

        .menu-btn.secondary:hover {
            box-shadow: 0 6px 20px rgba(78,205,196,0.6);
        }

        .menu-btn.danger {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            box-shadow: 0 4px 15px rgba(231,76,60,0.4);
        }

        .menu-btn.danger:hover {
            box-shadow: 0 6px 20px rgba(231,76,60,0.6);
        }

        .slots-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 30px;
        }

        .save-slot {
            background: rgba(50,50,80,0.9);
            border: 2px solid #666;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .save-slot:hover {
            border-color: #ffd700;
            background: rgba(80,80,120,0.9);
            transform: scale(1.02);
        }

        .save-slot.empty {
            border-style: dashed;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
            min-height: 100px;
        }

        .slot-number {
            color: #ffd700;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .slot-info {
            color: white;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .slot-info.stat {
            color: #4ecdc4;
            font-size: 12px;
        }

        .slot-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .slot-btn {
            flex: 1;
            padding: 8px 12px;
            font-size: 11px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .slot-btn.load {
            background: #4ecdc4;
            color: white;
        }

        .slot-btn.load:hover:not(:disabled) {
            background: #44a3a0;
        }

        .slot-btn.delete {
            background: #e74c3c;
            color: white;
        }

        .slot-btn.delete:hover:not(:disabled) {
            background: #c0392b;
        }

        .slot-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .menu-back-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 24px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 2001;
        }

        .menu-back-btn:hover {
            transform: scale(1.1);
            background: #c0392b;
        }

        .game-container.hidden {
            display: none;
        }

        /* Crate and Skin System Styles */
        .crates-section {
            display: none;
        }

        .crates-section.active {
            display: block;
        }

        .crates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .crate-card {
            background: rgba(50,50,80,0.9);
            border: 2px solid #666;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .crate-card:hover {
            border-color: #ffd700;
            transform: scale(1.05);
            background: rgba(80,80,120,0.9);
        }

        .crate-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .crate-name {
            color: #ffd700;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .crate-desc {
            color: #aaa;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .crate-price {
            color: #4ecdc4;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .crate-btn {
            background: linear-gradient(145deg, #4ecdc4, #44a3a0);
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            font-size: 12px;
        }

        .crate-btn:hover {
            transform: scale(1.05);
            background: linear-gradient(145deg, #44a3a0, #3a8a88);
        }

        .crate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Skin Opening Animation */
        .skin-reveal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #ffd700;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            z-index: 3000;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 400px;
            box-shadow: 0 0 50px rgba(255,215,0,0.5);
        }

        .skin-reveal.active {
            display: flex;
        }

        .skin-rarity {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
        }

        .skin-rarity.legendary {
            color: #ff6b35;
            text-shadow: 0 0 20px #ff6b35;
        }

        .skin-rarity.epic {
            color: #9b59b6;
            text-shadow: 0 0 20px #9b59b6;
        }

        .skin-rarity.rare {
            color: #4ecdc4;
            text-shadow: 0 0 20px #4ecdc4;
        }

        .skin-rarity.common {
            color: #95a5a6;
            text-shadow: 0 0 20px #95a5a6;
        }

        .skin-emoji {
            font-size: 80px;
            animation: skinReveal 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes skinReveal {
            0% { transform: scale(0) rotateY(0deg); }
            50% { transform: scale(1.2) rotateY(180deg); }
            100% { transform: scale(1) rotateY(360deg); }
        }

        .skin-name {
            color: white;
            font-size: 20px;
            font-weight: bold;
        }

        .skin-action-btn {
            background: linear-gradient(145deg, #4ecdc4, #44a3a0);
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .skin-action-btn:hover {
            transform: scale(1.05);
            background: linear-gradient(145deg, #44a3a0, #3a8a88);
        }

        /* Skins Modal */
        .skins-modal {
            max-width: 700px;
        }

        .skins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .skin-card {
            background: rgba(50,50,80,0.9);
            border: 2px solid #666;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .skin-card:hover {
            border-color: #ffd700;
            background: rgba(80,80,120,0.9);
        }

        .skin-card.owned::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 5px;
            background: #27ae60;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .skin-card.selected {
            background: rgba(78,205,196,0.3);
            border-color: #4ecdc4;
            box-shadow: 0 0 15px rgba(78,205,196,0.5);
        }

        .skin-rarity-badge {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            margin-top: 8px;
            font-weight: bold;
        }

        .skin-rarity-badge.legendary {
            background: #ff6b35;
            color: white;
        }

        .skin-rarity-badge.epic {
            background: #9b59b6;
            color: white;
        }

        .skin-rarity-badge.rare {
            background: #4ecdc4;
            color: white;
        }

        .skin-rarity-badge.common {
            background: #95a5a6;
            color: white;
        }

        .crate-menu-btn {
            background: linear-gradient(145deg, #9b59b6, #8e44ad);
            box-shadow: 0 4px 15px rgba(155,89,182,0.4);
        }
    </style>
</head>
<body>
    <!-- Main Menu -->
    <!-- LORE SCREEN -->
    <div class="lore-screen active" id="lore-screen">
        <div class="lore-container">
            <div class="lore-title">üëπ CURSED FATE üëπ</div>
            <div class="lore-text">You were once a humble <span class="lore-highlight">MINER</span>, digging deep into the earth.</div>
            <div class="lore-text">But a terrible curse befell you... <span class="lore-dark">Your soul was trapped forever in this mine.</span></div>
            <div class="lore-text">Now, your endless suffering generates <span class="lore-highlight">CURSED ENERGY</span> ‚Äî a dark power that summoned <span class="lore-dark">THE KING OF CURSES</span>, <span class="lore-dark">THE STRONGEST SORCERER</span>, and the <span class="lore-dark">GAMBLER OF DESTINY</span>.</div>
            <div class="lore-text">They fight endlessly in your soul, their domains clashing... while you dig deeper, forever bound to this curse.</div>
                <div class="lore-buttons">
                    <button class="lore-skip-btn" onclick="skipLore()">ENTER THE MINES ‚Üí</button>
                    <button class="lore-settings-btn" onclick="openMenuSettings()">‚öôÔ∏è SETTINGS</button>
                </div>
        </div>
    </div>

    <div class="main-menu active" id="main-menu">
        <div class="menu-container">
            <div class="menu-title">‚öíÔ∏è DIG DEEP</div>
            <div class="menu-subtitle">Idle Mining Game</div>
            
            <div class="menu-buttons">
                <button class="menu-btn" onclick="showSaveSlots('new')">üÜï NEW GAME</button>
                <button class="menu-btn secondary" onclick="showSaveSlots('load')">üìÇ LOAD GAME</button>
                <button class="menu-btn secondary" onclick="showCratesMenu()">üéÅ CRATES</button>
                <button class="menu-btn secondary" onclick="openMenuSettings()">‚öôÔ∏è SETTINGS</button>
            </div>

            <div id="slots-section" style="display: none;">
                <h3 style="color: #ffd700; margin-bottom: 15px; text-transform: uppercase;" id="slots-title">Select Save Slot</h3>
                <div class="slots-container" id="slots-container"></div>
                <button class="menu-btn secondary" style="margin-top: 20px; width: 100%;" onclick="backToMainMenu()">‚Üê Back to Menu</button>
            </div>

            <div id="crates-section" class="crates-section">
                <h3 style="color: #ffd700; margin-bottom: 15px; text-transform: uppercase;">üéÅ MYSTICAL CRATES</h3>
                <p style="color: #aaa; font-size: 12px; margin-bottom: 20px;">Open crates to get cosmetic shovel skins!</p>
                <div class="crates-grid" id="crates-grid"></div>
                <button class="menu-btn secondary" style="margin-top: 20px; width: 100%;" onclick="backToMainMenu()">‚Üê Back to Menu</button>
            </div>
        </div>
    </div>

    <!-- Skin Reveal Modal -->
    <div class="skin-reveal" id="skin-reveal-modal">
        <div style="color: #ffd700; font-size: 18px; font-weight: bold;">Opening Crate...</div>
        <div id="rarity-banner" class="skin-rarity"></div>
        <div id="skin-emoji-display" class="skin-emoji"></div>
        <div id="skin-name-display" class="skin-name"></div>
        <button class="skin-action-btn" onclick="closeSkinReveal()">Got it!</button>
    </div>

    <!-- Settings Modal for Menu -->
    <div class="modal" id="menu-settings-modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è Settings</h2>
                <button class="close-btn" onclick="closeMenuSettings()">√ó</button>
            </div>
            
            <div class="settings-section">
                <h3>üõ†Ô∏è Game Options</h3>
                <p style="color: #aaa; font-size: 13px; margin-bottom: 15px;">Configure game preferences.</p>
                <button class="buy-btn" style="width: 100%; background: #4ecdc4; padding: 12px;">üìù Continue to Last Save</button>
            </div>

            <div class="settings-section">
                <h3>üîê Admin Access</h3>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Enter admin code:</p>
                <input type="password" id="menu-admin-code-input" class="admin-code-input" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')checkAdminCode()">
                <button class="admin-btn" style="width: 100%;" onclick="checkAdminCode()">üîì Unlock Admin Panel</button>
            </div>

            <div class="settings-section">
                <h3 style="color: #e74c3c;">‚ö†Ô∏è Danger Zone</h3>
                <button class="buy-btn" style="width: 100%; background: #e74c3c; padding: 12px; margin-top: 10px;" onclick="resetAllProgressFromMenu()">
                    üóëÔ∏è Delete All Saves
                </button>
                <p style="color: #888; font-size: 11px; margin-top: 8px; text-align: center;">This will permanently delete ALL save slots!</p>
            </div>
        </div>
    </div>

    <div class="game-container" id="game-container">
        <div class="header">
            <div>
                <div class="money-display">üí∞ $<span id="money">0</span></div>
                <div class="rebirth-display">üîÑ Rebirths: <span id="rebirths">0</span></div>
                <div class="world-display">üåç World: <span id="current-world">Earth</span></div>
                <div class="depth-display">‚õèÔ∏è Depth: <span id="depth">0</span>m</div>
                <div class="depth-display" style="color: #ff6b35;">üéÅ Crate Coins: <span id="crate-coins">0</span></div>
            </div>
            <div class="btn-group">
                <button class="worlds-btn" onclick="openWorlds()">üåç WORLDS</button>
                <button class="shop-btn skill-tree-btn" onclick="openSkillTree()">üåü SKILLS</button>
                <button class="shop-btn workers-btn" onclick="openWorkers()">üë∑ WORKERS</button>
                <button class="rebirth-btn" onclick="openRebirth()">üîÑ REBIRTH</button>
                <button class="shop-btn" onclick="openShop()">üõí SHOP</button>
                <button class="shop-btn save-btn" onclick="saveGameUI()">üíæ SAVE</button>
                <button class="shop-btn settings-btn" onclick="openGameSettings()">‚öôÔ∏è SETTINGS</button>
                <button class="shop-btn" style="background: linear-gradient(145deg, #e74c3c, #c0392b); box-shadow: 0 4px 15px rgba(231,76,60,0.4);" onclick="backToMenu()">üè† MENU</button>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat">Power: <span class="stat-value" id="power-stat">1</span></div>
            <div class="stat">Luck: <span class="stat-value" id="luck-stat">1</span>x</div>
            <div class="stat">Auto: <span class="stat-value" id="auto-stat">0</span>/s</div>
            <div class="stat">Ore Mult: <span class="stat-value" id="ore-stat">1</span>x</div>
            <div class="stat">World Mult: <span class="stat-value" id="world-mult">1</span>x</div>
            <div class="stat">Rebirth Mult: <span class="stat-value" id="rebirth-mult">1</span>x</div>
            <div class="stat">Workers: <span class="stat-value" id="workers-stat">0</span></div>
        </div>

        <div class="mining-area" id="mining-area" onclick="dig(event)">
            <div class="surface-layer" id="surface-layer">
                <div class="surface-emoji" id="surface-emoji">üå± üåø üå± üåæ üå± üåø üåæ üå± üåø</div>
            </div>
            <div class="dirt-layer" id="dirt-layer"></div>
            <div class="shovel" id="shovel">ü™è</div>
        </div>

        <div class="ore-legend" id="ore-legend"></div>

        <div class="instructions">Click anywhere to dig and find ores. Click ORES to collect money! Rebirth at $100M for bonuses!</div>
    </div>

    <!-- Workers Modal -->
    <div class="modal" id="workers-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üë∑ Workers</h2>
                <button class="close-btn" onclick="closeWorkers()">√ó</button>
            </div>
            <div style="color: #ddd; margin-bottom: 15px; text-align: center;">
                <p>Workers automatically walk to ores and collect them for you!</p>
                <p style="color: #9b59b6; margin-top: 10px;">Active Workers: <span id="worker-count">0</span></p>
            </div>
            
            <h3 style="color: #9b59b6; margin: 20px 0 10px; border-bottom: 2px solid #9b59b6; padding-bottom: 5px;">üë∑ Hire Workers</h3>
            <div id="workers-container"></div>
        </div>
    </div>

    <!-- Shop Modal -->
    <div class="modal" id="shop-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚õèÔ∏è Upgrade Shop</h2>
                <button class="close-btn" onclick="closeShop()">√ó</button>
            </div>
            <div id="upgrades-container"></div>
        </div>
    </div>

    <!-- Rebirth Modal -->
    <div class="modal" id="rebirth-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üîÑ Rebirth</h2>
                <button class="close-btn" onclick="closeRebirth()">√ó</button>
            </div>
            <div class="rebirth-info">
                <h3>Reset for Power!</h3>
                <p>Rebirth resets your money, depth, and upgrades but gives you a permanent 1.5x multiplier per rebirth!</p>
                <p>Rebirths are required to unlock new worlds with better ores!</p>
                <div class="rebirth-cost">Cost: $1,000,000,000 (1B)</div>
                <p style="margin-top: 10px;">Current Rebirth Bonus: <span id="rebirth-bonus">1</span>x</p>
            </div>
            <button class="buy-btn" id="rebirth-btn" onclick="doRebirth()" style="width: 100%; padding: 15px; font-size: 18px;">
                üîÑ REBIRTH NOW
            </button>
        </div>
    </div>

    <!-- Skill Tree Modal -->
    <div class="modal" id="skill-tree-modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">üåü Skill Tree</h2>
                <button class="close-btn" onclick="closeSkillTree()">√ó</button>
            </div>
            <div class="skill-tree-container">
                <div class="skill-points-display">
                    üí∞ Your Money: $<span id="skill-money">0</span>
                </div>
                <p style="color: #ff6b6b; text-align: center; font-size: 13px;">‚ö†Ô∏è Choose ONE path - this cannot be undone!</p>
                <div class="path-selection" id="path-selection"></div>
                <div class="upgrade-choices" id="upgrade-choices">
                    <h3>Choose Your Next Upgrade (Pick 1 of 3)</h3>
                    <div class="skill-tree-progress" id="skill-progress"></div>
                    <div class="choice-options" id="choice-options"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Worlds Modal -->
    <div class="modal" id="worlds-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üåç Worlds</h2>
                <button class="close-btn" onclick="closeWorlds()">√ó</button>
            </div>
            <p style="color: #aaa; margin-bottom: 15px; text-align: center;">Each world has unique ores and multipliers. Unlock with rebirths!</p>
            <div id="worlds-container"></div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div class="modal" id="admin-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 class="modal-title">üîß Admin Panel</h2>
                <button class="close-btn" onclick="closeAdmin()">√ó</button>
            </div>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button class="admin-btn" onclick="admin1000Rebirths()">üîÑ +1000 Rebirths</button>
                <button class="admin-btn" onclick="adminTrillionMoney()">üí∞ +1 Trillion Money</button>
                <button class="admin-btn" onclick="adminMaxMoney()">üíé +1e66 Money (Max)</button>
                <button class="admin-btn" id="hakari-toggle-btn" onclick="toggleHakariMode()">üé∞ 100% Hakari: OFF</button>
                <button class="admin-btn" onclick="adminSpawnHakari()">‚≠ê Spawn Hakari Now</button>
                <button class="admin-btn" onclick="adminSpawnStrongest()">‚ôæÔ∏è Spawn The Strongest</button>
                <button class="admin-btn" onclick="adminSpawnSukuna()">üëπ Spawn Sukuna (1/1T chance)</button>
            </div>
            <p style="color: #ff6b6b; font-size: 12px; margin-top: 20px; text-align: center;">‚ö†Ô∏è Testing only - breaks game balance!</p>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è Settings</h2>
                <button class="close-btn" onclick="closeSettings()">√ó</button>
            </div>
            
            <div class="settings-section">
                <h3>ÔøΩ Customize</h3>
                <button class="buy-btn" style="width: 100%; background: #9b59b6; padding: 12px; margin-bottom: 10px;" onclick="openSkinsModal()">
                    üé® View My Skins
                </button>
                <button class="buy-btn" style="width: 100%; background: #ff6b35; padding: 12px; margin-bottom: 10px;" onclick="openSkinShop()">
                    üõçÔ∏è Buy Skins (üéÅ<span id="settings-coins-display">0</span>)
                </button>
            </div>
            
            <div class="settings-section">
                <h3>üõ†Ô∏è Game Settings</h3>
                <div style="padding: 15px 0;">
                    <button class="buy-btn" style="width: 100%; background: #dc3545; padding: 12px;" onclick="resetAllProgress()">
                        üóëÔ∏è Reset All Progress
                    </button>
                    <p style="color: #888; font-size: 11px; margin-top: 8px; text-align: center;">Warning: This will delete ALL save data permanently!</p>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>üîê Admin Access</h3>
                <p style="color: #888; font-size: 12px; margin-bottom: 10px;">Enter admin code:</p>
                <input type="password" id="admin-code-input" class="admin-code-input" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')checkAdminCode()">
                <button class="admin-btn" style="width: 100%;" onclick="checkAdminCode()">üîì Unlock Admin Panel</button>
            </div>
        </div>
    </div>

    <!-- Skins Modal -->
    <div class="modal" id="skins-modal">
        <div class="modal-content skins-modal">
            <div class="modal-header">
                <h2 class="modal-title">üé® My Skins</h2>
                <button class="close-btn" onclick="closeSkinsModal()">√ó</button>
            </div>
            
            <div style="margin-bottom: 15px;">
                <p style="color: #aaa; font-size: 12px; margin-bottom: 10px;">Your collected shovel skins:</p>
                <div class="skins-grid" id="skins-grid"></div>
            </div>
            
            <div style="text-align: center; color: #888; font-size: 12px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                Click a skin to select it ‚Ä¢ Get more skins by opening crates!
            </div>
        </div>
    </div>

    <!-- Skin Shop Modal -->
    <div class="modal" id="skin-shop-modal">
        <div class="modal-content skins-modal">
            <div class="modal-header">
                <h2 class="modal-title">üõçÔ∏è Skin Shop</h2>
                <button class="close-btn" onclick="closeSkinShop()">√ó</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 15px; padding: 10px; background: rgba(255,215,0,0.1); border-radius: 8px;">
                <p style="color: #ffd700; font-weight: bold;">Your Crate Coins: <span id="shop-coins-display">0</span> üéÅ</p>
            </div>
            
            <div style="margin-bottom: 15px;">
                <p style="color: #aaa; font-size: 12px; margin-bottom: 10px;">Buy skins directly with Crate Coins:</p>
                <div class="skins-grid" id="skin-shop-grid"></div>
            </div>
            
            <div style="text-align: center; color: #888; font-size: 12px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                üí° Tip: Open crates for a chance at skins, or buy them here directly!
            </div>
        </div>
    </div>

    <script>
        // Game State
        let money = 0;
        let depth = 0;
        let rebirths = 0;
        let currentWorld = 0;
        let ores = [];
        let skillPoints = 0;
        let chosenPath = null; // null, 0, 1, or 2
        let pathProgress = {}; // tracks which upgrades are owned per path
        
        // Worker State
        let workers = [];
        let workerCounts = { broke: 0, basic: 0, fast: 0, strong: 0, elite: 0, strongest: 0, sukuna: 0 };
        let adminHakariMode = false; // Admin: 100% Hakari spawn chance
        let adminCodeBuffer = ''; // For tracking admin code input
        
        // Worker Types Configuration
        const workerTypes = [
            { id: 'broke', name: 'Broke Worker', icon: 'üòÖ', baseCost: 10, costMult: 1.3, speed: 20, collectMult: 0.5, color: '#95a5a6' },
            { id: 'basic', name: 'Basic Worker', icon: 'üë∑', baseCost: 10000, costMult: 1.5, speed: 50, collectMult: 1, color: '#3498db' },
            { id: 'fast', name: 'Fast Worker', icon: 'üèÉ', baseCost: 100000, costMult: 1.6, speed: 100, collectMult: 1, color: '#2ecc71' },
            { id: 'strong', name: 'Strong Worker', icon: 'üí™', baseCost: 1000000, costMult: 1.7, speed: 40, collectMult: 3, color: '#e74c3c' },
            { id: 'elite', name: 'Elite Worker', icon: '‚≠ê', baseCost: 50000000, costMult: 1.8, speed: 80, collectMult: 5, color: '#9b59b6' },
            { id: 'strongest', name: 'The Strongest', icon: 'üëÅÔ∏è', baseCost: 1e65, costMult: 2.0, speed: 150, collectMult: 10, color: '#00bfff', maxCount: 1 },
            { id: 'sukuna', name: 'Ryomen Sukuna', icon: 'üëπ', baseCost: 3e65, costMult: 2.5, speed: 140, collectMult: 12, color: '#8b0000', maxCount: 1 }
        ];

        // Skins and Crates System - Cosmetic skins for the shovel
        let ownedSkins = { default: true }; // Track owned skins
        let selectedSkin = 'default'; // Currently selected skin
        let crateCoins = 0; // Currency for crates (earned from rebirths)
        let lastCrateOpenTime = {}; // Track cooldown for each crate
        const CRATE_COOLDOWN = 5000; // 5 second cooldown between opens

        const shovelCrates = [
            {
                id: 'stone_crate',
                name: '‚õèÔ∏è Stone Crate',
                icon: 'üì¶',
                description: 'Classic mine tools',
                price: 3,
                skins: [
                    { id: 'pickaxe_gold', name: 'üèÜ Golden Pickaxe', rarity: 'legendary', emoji: '‚õèÔ∏è' },
                    { id: 'pickaxe_diamond', name: 'üíé Diamond Pick', rarity: 'legendary', emoji: '‚õíÔ∏è' },
                    { id: 'axe_silver', name: 'üéñÔ∏è Silver Axe', rarity: 'epic', emoji: 'ü™ì' },
                    { id: 'hammer_iron', name: 'üî® Iron Hammer', rarity: 'epic', emoji: 'üî®' },
                    { id: 'pickaxe_steel', name: 'üèÖ Steel Pick', rarity: 'rare', emoji: '‚õèÔ∏è' },
                    { id: 'shovel_stone', name: 'ü™® Stone Shovel', rarity: 'rare', emoji: 'ü™£' },
                    { id: 'hoe_wood', name: 'üåæ Wood Hoe', rarity: 'common', emoji: '‚öíÔ∏è' },
                    { id: 'pick_rusty', name: 'üß° Rusty Pick', rarity: 'common', emoji: '‚õèÔ∏è' },
                    { id: 'spade_copper', name: 'üü† Copper Spade', rarity: 'common', emoji: 'ü™ì' },
                    { id: 'mattock', name: '‚öôÔ∏è Mattock', rarity: 'common', emoji: '‚õíÔ∏è' }
                ]
            },
            {
                id: 'lava_crate',
                name: 'üî• Lava Crate',
                icon: 'üåã',
                description: 'Volcanic mining gear',
                price: 5,
                skins: [
                    { id: 'pickaxe_inferno', name: 'üî• Inferno Pick', rarity: 'legendary', emoji: 'üå™Ô∏è' },
                    { id: 'pickaxe_magma', name: 'üåã Magma Pick', rarity: 'legendary', emoji: '‚ö°' },
                    { id: 'axe_flame', name: 'üîó Flame Axe', rarity: 'epic', emoji: 'ü™ì' },
                    { id: 'hammer_lava', name: 'üî• Lava Hammer', rarity: 'epic', emoji: 'üî®' },
                    { id: 'pick_volcanic', name: 'üü° Volcanic Pick', rarity: 'rare', emoji: '‚õèÔ∏è' },
                    { id: 'shovel_heated', name: 'üå°Ô∏è Heated Shovel', rarity: 'rare', emoji: 'ü™£' },
                    { id: 'pick_glowing', name: '‚ú® Glowing Pick', rarity: 'common', emoji: '‚õèÔ∏è' },
                    { id: 'hammer_hot', name: 'üî• Hot Hammer', rarity: 'common', emoji: 'üî®' },
                    { id: 'axe_warm', name: 'üü† Warm Axe', rarity: 'common', emoji: 'ü™ì' },
                    { id: 'pick_ember', name: 'üåÖ Ember Pick', rarity: 'common', emoji: '‚õíÔ∏è' }
                ]
            },
            {
                id: 'ice_crate',
                name: '‚ùÑÔ∏è Frost Crate',
                icon: 'üßä',
                description: 'Frozen mining tools',
                price: 5,
                skins: [
                    { id: 'pickaxe_frost', name: '‚ùÑÔ∏è Frostbite Pick', rarity: 'legendary', emoji: '‚ùÑÔ∏è' },
                    { id: 'pickaxe_blizzard', name: 'üå®Ô∏è Blizzard Axe', rarity: 'legendary', emoji: 'üå¨Ô∏è' },
                    { id: 'axe_ice', name: 'üßä Ice Axe', rarity: 'epic', emoji: 'ü™ì' },
                    { id: 'hammer_frozen', name: 'üîµ Frozen Hammer', rarity: 'epic', emoji: 'üî®' },
                    { id: 'pick_glacial', name: 'üíô Glacial Pick', rarity: 'rare', emoji: '‚õèÔ∏è' },
                    { id: 'shovel_ice', name: '‚ùÑÔ∏è Ice Shovel', rarity: 'rare', emoji: 'ü™£' },
                    { id: 'pick_crystal', name: 'üíé Crystal Pick', rarity: 'common', emoji: '‚õèÔ∏è' },
                    { id: 'hammer_icy', name: 'üîµ Icy Hammer', rarity: 'common', emoji: 'üî®' },
                    { id: 'axe_snow', name: '‚ö™ Snow Axe', rarity: 'common', emoji: 'ü™ì' },
                    { id: 'pick_chilled', name: 'üßä Chilled Pick', rarity: 'common', emoji: '‚õíÔ∏è' }
                ]
            },
            {
                id: 'dark_crate',
                name: 'üåë Shadow Crate',
                icon: 'üëª',
                description: 'Cursed mining tools',
                price: 8,
                skins: [
                    { id: 'pickaxe_void', name: 'üåå Void Pick', rarity: 'legendary', emoji: 'üåÄ' },
                    { id: 'pickaxe_shadow', name: 'üñ§ Shadow Pick', rarity: 'legendary', emoji: 'üíÄ' },
                    { id: 'axe_dark', name: '‚ö´ Dark Axe', rarity: 'epic', emoji: 'ü™ì' },
                    { id: 'hammer_cursed', name: 'üëø Cursed Hammer', rarity: 'epic', emoji: 'üî®' },
                    { id: 'pick_obsidian', name: 'üî≥ Obsidian Pick', rarity: 'rare', emoji: '‚õèÔ∏è' },
                    { id: 'shovel_midnight', name: 'üåë Midnight Shovel', rarity: 'rare', emoji: 'ü™£' },
                    { id: 'pick_shadow', name: 'üå´Ô∏è Shadow Pick', rarity: 'common', emoji: '‚õèÔ∏è' },
                    { id: 'hammer_dark', name: '‚ö´ Dark Hammer', rarity: 'common', emoji: 'üî®' },
                    { id: 'axe_night', name: 'üåô Night Axe', rarity: 'common', emoji: 'ü™ì' },
                    { id: 'pick_gothic', name: 'üèöÔ∏è Gothic Pick', rarity: 'common', emoji: '‚õíÔ∏è' }
                ]
            },
            {
                id: 'mystic_crate',
                name: '‚ú® Mystic Crate',
                icon: 'üîÆ',
                description: 'Magical mining gear',
                price: 10,
                skins: [
                    { id: 'pickaxe_arcane', name: 'üîÆ Arcane Pick', rarity: 'legendary', emoji: '‚ú®' },
                    { id: 'pickaxe_cosmic', name: 'üå† Cosmic Pick', rarity: 'legendary', emoji: 'üåå' },
                    { id: 'axe_magic', name: 'ü™Ñ Magic Axe', rarity: 'epic', emoji: 'ü™ì' },
                    { id: 'hammer_enchanted', name: '‚≠ê Enchanted Hammer', rarity: 'epic', emoji: 'üî®' },
                    { id: 'pick_mystical', name: 'üíú Mystical Pick', rarity: 'rare', emoji: '‚õèÔ∏è' },
                    { id: 'shovel_ethereal', name: 'üëª Ethereal Shovel', rarity: 'rare', emoji: 'ü™£' },
                    { id: 'pick_magical', name: 'üåü Magical Pick', rarity: 'common', emoji: '‚õèÔ∏è' },
                    { id: 'hammer_spell', name: 'üí† Spell Hammer', rarity: 'common', emoji: 'üî®' },
                    { id: 'axe_rune', name: '‚öõÔ∏è Rune Axe', rarity: 'common', emoji: 'ü™ì' },
                    { id: 'pick_crystal', name: 'üíé Crystal Pick', rarity: 'common', emoji: '‚õíÔ∏è' }
                ]
            }
        ];

        // Worlds Configuration - Surface backgrounds with mining palettes
        const worlds = [
            { name: "Earth", rebirthCost: 0, multiplier: 1, 
              bg: "linear-gradient(180deg, #87CEEB 0%, #b0e0e6 15%, #98d1a8 20%, #6b8e23 25%, #556b2f 28%, #8B4513 35%, #5a3d2b 100%)", 
              miningBg: "linear-gradient(180deg, #8B6914 0%, #6B4423 15%, #5A3A1F 30%, #4A2F1A 45%, #3D2515 60%, #2D1A0F 75%, #1F120A 90%, #0F0905 100%)",
              surfaceBg: "linear-gradient(180deg, #228b22 0%, #32cd32 40%, #556b2f 70%, #8b4513 100%)",
              surfaceEmoji: "üå± üåø üå± üåæ üå± üåø üåæ üå± üåø" },
            { name: "Mars", rebirthCost: 1, multiplier: 5, 
              bg: "linear-gradient(180deg, #e8967a 0%, #d2691e 15%, #cd5c5c 22%, #b22222 28%, #8b2500 35%, #5c1a1a 100%)", 
              miningBg: "linear-gradient(180deg, #c45c3a 0%, #a0422a 15%, #8b2500 30%, #6b1a00 50%, #4a1000 70%, #2d0808 85%, #1a0505 100%)",
              surfaceBg: "linear-gradient(180deg, #cd5c5c 0%, #b22222 40%, #8b2500 70%, #5c1a1a 100%)",
              surfaceEmoji: "ü™® üåã ü™® ‚≠ê ü™® üåã ü™® ‚≠ê ü™®" },
            { name: "Moon", rebirthCost: 2, multiplier: 15, 
              bg: "linear-gradient(180deg, #0a0a15 0%, #1a1a2e 15%, #2d2d44 22%, #4a4a5a 28%, #6a6a7a 33%, #808080 40%, #5a5a5a 100%)", 
              miningBg: "linear-gradient(180deg, #9a9a9a 0%, #7a7a7a 15%, #5a5a5a 30%, #4a4a4a 50%, #3a3a3a 70%, #2a2a2a 85%, #1a1a1a 100%)",
              surfaceBg: "linear-gradient(180deg, #a0a0a0 0%, #808080 40%, #606060 70%, #404040 100%)",
              surfaceEmoji: "üåô ‚≠ê üåô üëΩ üåô ‚≠ê üåô üëΩ üåô" },
            { name: "Asteroid Belt", rebirthCost: 4, multiplier: 40, 
              bg: "linear-gradient(180deg, #000011 0%, #000428 15%, #001144 25%, #002255 32%, #003366 40%, #2c3e50 100%)", 
              miningBg: "linear-gradient(180deg, #4a5568 0%, #3a4556 15%, #2c3e50 30%, #1f2d3d 50%, #152233 70%, #0d1520 85%, #050a0f 100%)",
              surfaceBg: "linear-gradient(180deg, #5a6a7a 0%, #3a4a5a 40%, #2a3a4a 70%, #1a2a3a 100%)",
              surfaceEmoji: "‚òÑÔ∏è ü™® ‚òÑÔ∏è ‚≠ê ‚òÑÔ∏è ü™® ‚òÑÔ∏è ‚≠ê ‚òÑÔ∏è" },
            { name: "Jupiter Core", rebirthCost: 8, multiplier: 100, 
              bg: "linear-gradient(180deg, #f4a460 0%, #daa520 15%, #cd853f 25%, #b8860b 32%, #8b7355 40%, #5c3317 100%)", 
              miningBg: "linear-gradient(180deg, #e6b87a 0%, #d4a574 15%, #b8860b 30%, #8b6914 50%, #6b4f10 70%, #4a3810 85%, #2a200a 100%)",
              surfaceBg: "linear-gradient(180deg, #f4a460 0%, #daa520 40%, #cd853f 70%, #b8860b 100%)",
              surfaceEmoji: "üåÄ ‚ö° üåÄ üí® üåÄ ‚ö° üåÄ üí® üåÄ" },
            { name: "Neutron Star", rebirthCost: 15, multiplier: 300, 
              bg: "linear-gradient(180deg, #e0aaff 0%, #c77dff 15%, #9d4edd 25%, #7b2cbf 32%, #5a189a 40%, #3c096c 100%)", 
              miningBg: "linear-gradient(180deg, #c77dff 0%, #9d4edd 15%, #7b2cbf 30%, #5a189a 50%, #3c096c 70%, #240046 85%, #10002b 100%)",
              surfaceBg: "linear-gradient(180deg, #e0aaff 0%, #c77dff 40%, #9d4edd 70%, #7b2cbf 100%)",
              surfaceEmoji: "‚ú® üí´ ‚ú® üåü ‚ú® üí´ ‚ú® üåü ‚ú®" },
            { name: "Black Hole Edge", rebirthCost: 25, multiplier: 1000, 
              bg: "linear-gradient(180deg, #1a0a2e 0%, #16082a 15%, #0f0520 25%, #0a0315 32%, #05010a 40%, #000000 100%)", 
              miningBg: "linear-gradient(180deg, #2d1f4e 0%, #1f1535 15%, #150f25 30%, #0d0a1a 50%, #08050f 70%, #040308 85%, #000000 100%)",
              surfaceBg: "linear-gradient(180deg, #2d1f4e 0%, #1a1030 40%, #0f0820 70%, #050410 100%)",
              surfaceEmoji: "üï≥Ô∏è ‚¨õ üï≥Ô∏è üåå üï≥Ô∏è ‚¨õ üï≥Ô∏è üåå üï≥Ô∏è" },
            { name: "Quantum Realm", rebirthCost: 50, multiplier: 3000, 
              bg: "linear-gradient(180deg, #00ffaa 0%, #00e699 15%, #00cc88 25%, #00b377 32%, #009966 40%, #006644 100%)", 
              miningBg: "linear-gradient(180deg, #00ffcc 0%, #00ddaa 15%, #00bb88 30%, #009966 50%, #007744 70%, #005522 85%, #003311 100%)",
              surfaceBg: "linear-gradient(180deg, #00ffcc 0%, #00ddaa 40%, #00bb88 70%, #009966 100%)",
              surfaceEmoji: "‚öõÔ∏è üîÆ ‚öõÔ∏è üåÄ ‚öõÔ∏è üîÆ ‚öõÔ∏è üåÄ ‚öõÔ∏è" },
            { name: "Obsidian Abyss", rebirthCost: 100, multiplier: 10000, 
              bg: "linear-gradient(180deg, #0a0a0a 0%, #1a1a2a 15%, #2a2a3a 25%, #3a3a4a 32%, #4a4a5a 40%, #2a2a2a 100%)", 
              miningBg: "linear-gradient(180deg, #3a3a4a 0%, #2a2a3a 15%, #1a1a2a 30%, #0f0f1a 50%, #0a0a0f 70%, #050508 85%, #000000 100%)",
              surfaceBg: "linear-gradient(180deg, #3a3a4a 0%, #2a2a3a 40%, #1a1a2a 70%, #0a0a0a 100%)",
              surfaceEmoji: "üíÄ üñ§ üíÄ ‚¨õ üíÄ üñ§ üíÄ ‚¨õ üíÄ" },
            { name: "Crystalline Aurora", rebirthCost: 200, multiplier: 30000, 
              bg: "linear-gradient(180deg, #00ffff 0%, #00aaff 15%, #0055ff 25%, #0033aa 32%, #001166 40%, #003366 100%)", 
              miningBg: "linear-gradient(180deg, #00eeff 0%, #0099ff 15%, #0055ff 30%, #0033aa 50%, #001177 70%, #000555 85%, #000033 100%)",
              surfaceBg: "linear-gradient(180deg, #00ffff 0%, #0099ff 40%, #0055ff 70%, #003366 100%)",
              surfaceEmoji: "‚ùÑÔ∏è üíé ‚ùÑÔ∏è ‚ú® ‚ùÑÔ∏è üíé ‚ùÑÔ∏è ‚ú® ‚ùÑÔ∏è" },
            { name: "Volcanic Inferno", rebirthCost: 400, multiplier: 100000, 
              bg: "linear-gradient(180deg, #ff3300 0%, #ff6600 15%, #ff9900 25%, #ffaa00 32%, #cc6600 40%, #660000 100%)", 
              miningBg: "linear-gradient(180deg, #ff5522 0%, #ff4411 15%, #dd3300 30%, #bb2200 50%, #991100 70%, #550800 85%, #220300 100%)",
              surfaceBg: "linear-gradient(180deg, #ff6600 0%, #ff4400 40%, #dd2200 70%, #660000 100%)",
              surfaceEmoji: "üî• üåã üî• üí• üî• üåã üî• üí• üî•" },
            { name: "Twilight Gardens", rebirthCost: 800, multiplier: 500000, 
              bg: "linear-gradient(180deg, #9966ff 0%, #7744ff 15%, #5533ff 25%, #4422dd 32%, #333388 40%, #222255 100%)", 
              miningBg: "linear-gradient(180deg, #aa77ff 0%, #8855ff 15%, #6633ff 30%, #4422dd 50%, #332299 70%, #221166 85%, #110033 100%)",
              surfaceBg: "linear-gradient(180deg, #aa77ff 0%, #8855ff 40%, #6633ff 70%, #333388 100%)",
              surfaceEmoji: "üå∏ ü¶ã üå∏ üëÅÔ∏è üå∏ ü¶ã üå∏ üëÅÔ∏è üå∏" },
            { name: "Metallic Dimension", rebirthCost: 1600, multiplier: 2000000, 
              bg: "linear-gradient(180deg, #cccccc 0%, #999999 15%, #666666 25%, #444444 32%, #333333 40%, #111111 100%)", 
              miningBg: "linear-gradient(180deg, #bbbbbb 0%, #888888 15%, #555555 30%, #333333 50%, #222222 70%, #111111 85%, #000000 100%)",
              surfaceBg: "linear-gradient(180deg, #aaaaaa 0%, #777777 40%, #444444 70%, #222222 100%)",
              surfaceEmoji: "‚öôÔ∏è üîß ‚öôÔ∏è ü§ñ ‚öôÔ∏è üîß ‚öôÔ∏è ü§ñ ‚öôÔ∏è" },
            { name: "Enchanted Forest", rebirthCost: 3200, multiplier: 10000000, 
              bg: "linear-gradient(180deg, #228b22 0%, #2e8b57 15%, #228b22 25%, #1a6b1a 32%, #0d3d0d 40%, #052005 100%)", 
              miningBg: "linear-gradient(180deg, #3aa654 0%, #2d8a4d 15%, #228b22 30%, #1a6b1a 50%, #0f4a0f 70%, #072107 85%, #020802 100%)",
              surfaceBg: "linear-gradient(180deg, #3aa654 0%, #228b22 40%, #1a6b1a 70%, #052005 100%)",
              surfaceEmoji: "üå≥ üçÑ üå≥ üåø üå≥ üçÑ üå≥ üåø üå≥" },
            { name: "Temporal Vortex", rebirthCost: 6400, multiplier: 50000000, 
              bg: "linear-gradient(180deg, #ff00ff 0%, #aa00ff 15%, #5500ff 25%, #0000ff 32%, #000088 40%, #000044 100%)", 
              miningBg: "linear-gradient(180deg, #ff33ff 0%, #cc00ff 15%, #7700ff 30%, #3300ff 50%, #000099 70%, #000044 85%, #000022 100%)",
              surfaceBg: "linear-gradient(180deg, #ff00ff 0%, #8800ff 40%, #3300ff 70%, #000055 100%)",
              surfaceEmoji: "‚è∞ üåÄ ‚è∞ üï∞Ô∏è ‚è∞ üåÄ ‚è∞ üï∞Ô∏è ‚è∞" },
            { name: "Celestial Haven", rebirthCost: 12800, multiplier: 200000000, 
              bg: "linear-gradient(180deg, #ffff00 0%, #ffdd00 15%, #ffaa00 25%, #ff8800 32%, #dd6600 40%, #bb4400 100%)", 
              miningBg: "linear-gradient(180deg, #ffff55 0%, #ffee33 15%, #ffcc00 30%, #ff9900 50%, #dd6600 70%, #bb4400 85%, #774400 100%)",
              surfaceBg: "linear-gradient(180deg, #ffff00 0%, #ffcc00 40%, #ff9900 70%, #dd6600 100%)",
              surfaceEmoji: "‚òÄÔ∏è ‚≠ê ‚òÄÔ∏è üåü ‚òÄÔ∏è ‚≠ê ‚òÄÔ∏è üåü ‚òÄÔ∏è" },
            { name: "Abyssal Trench", rebirthCost: 25600, multiplier: 1000000000, 
              bg: "linear-gradient(180deg, #001133 0%, #002255 15%, #003366 25%, #004477 32%, #003366 40%, #001133 100%)", 
              miningBg: "linear-gradient(180deg, #004488 0%, #003366 15%, #002244 30%, #001133 50%, #000f22 70%, #00080f 85%, #000000 100%)",
              surfaceBg: "linear-gradient(180deg, #004488 0%, #003366 40%, #002244 70%, #001133 100%)",
              surfaceEmoji: "üåä üêô üåä üåÄ üåä üêô üåä üåÄ üåä" },
            { name: "Sanctum of Light", rebirthCost: 51200, multiplier: 5000000000, 
              bg: "linear-gradient(180deg, #ffffcc 0%, #ffffaa 15%, #ffff88 25%, #ffff66 32%, #ffff44 40%, #ffff00 100%)", 
              miningBg: "linear-gradient(180deg, #ffffdd 0%, #ffffcc 15%, #ffff99 30%, #ffff66 50%, #ffff33 70%, #ffff00 85%, #cccc00 100%)",
              surfaceBg: "linear-gradient(180deg, #ffffcc 0%, #ffff88 40%, #ffff44 70%, #ffff00 100%)",
              surfaceEmoji: "‚ú® üòá ‚ú® üëº ‚ú® üòá ‚ú® üëº ‚ú®" },
            { name: "Void Nexus", rebirthCost: 102400, multiplier: 50000000000, 
              bg: "linear-gradient(180deg, #000000 0%, #0a0a1a 15%, #1a1a3a 25%, #2a2a4a 32%, #1a1a2a 40%, #000000 100%)", 
              miningBg: "linear-gradient(180deg, #1a1a2a 0%, #0f0f1a 15%, #0a0a0f 30%, #050508 50%, #030303 70%, #010101 85%, #000000 100%)",
              surfaceBg: "linear-gradient(180deg, #1a1a2a 0%, #0a0a0f 40%, #050508 70%, #000000 100%)",
              surfaceEmoji: "üåå ‚¨õ üåå üëæ üåå ‚¨õ üåå üëæ üåå" },
            { name: "Chromatic Realm", rebirthCost: 204800, multiplier: 200000000000, 
              bg: "linear-gradient(180deg, #ff0000 0%, #ff7700 15%, #ffff00 25%, #00ff00 32%, #0000ff 40%, #ff00ff 100%)", 
              miningBg: "linear-gradient(180deg, #ff3333 0%, #ffaa33 15%, #ffff33 30%, #33ff33 50%, #3333ff 70%, #ff33ff 85%, #ff0088 100%)",
              surfaceBg: "linear-gradient(180deg, #ff3333 0%, #ffaa33 40%, #33ff33 70%, #3333ff 100%)",
              surfaceEmoji: "üé® üåà üé® üí´ üé® üåà üé® üí´ üé®" },
            { name: "Primordial Chaos", rebirthCost: 409600, multiplier: 1000000000000, 
              bg: "linear-gradient(180deg, #4d004d 0%, #660000 15%, #004d4d 25%, #004d66 32%, #1a0066 40%, #0d0033 100%)", 
              miningBg: "linear-gradient(180deg, #660066 0%, #660033 15%, #336633 30%, #003366 50%, #330066 70%, #1a0033 85%, #000000 100%)",
              surfaceBg: "linear-gradient(180deg, #660066 0%, #336633 40%, #003366 70%, #0d0033 100%)",
              surfaceEmoji: "üåÄ üëø üåÄ üî± üåÄ üëø üåÄ üî± üåÄ" }
        ];

        // Upgrades (Much harder progression)
        const upgrades = {
            shovelPower: { 
                name: "Shovel Power", 
                description: "Increase base mining power",
                level: 1, 
                baseCost: 100, 
                costMultiplier: 1.8,
                icon: "üí™"
            },
            luck: { 
                name: "Lucky Charm", 
                description: "Better chance for rare ores (+25% per level)",
                level: 1, 
                baseCost: 400, 
                costMultiplier: 2.0,
                icon: "üçÄ"
            },
            autoDig: { 
                name: "Auto Digger", 
                description: "Automatically spawns ores each second",
                level: 0, 
                baseCost: 2000, 
                costMultiplier: 2.5,
                icon: "ü§ñ"
            },
            oreValue: { 
                name: "Ore Refinery", 
                description: "Increase value of all ores",
                level: 1, 
                baseCost: 5000, 
                costMultiplier: 2.2,
                icon: "üíé"
            },
            depthBonus: { 
                name: "Deep Mining", 
                description: "Better ores appear at shallower depths",
                level: 0, 
                baseCost: 15000, 
                costMultiplier: 2.5,
                icon: "‚¨áÔ∏è"
            },
            oreSpawn: { 
                name: "Ore Detector", 
                description: "Slightly increase ore spawn rate",
                level: 0, 
                baseCost: 50000, 
                costMultiplier: 2.5,
                icon: "üì°"
            },
            critChance: { 
                name: "Critical Strike", 
                description: "Chance for 5x money on dig",
                level: 0, 
                baseCost: 100000, 
                costMultiplier: 2.8,
                icon: "‚ö°"
            },
            // New Upgrades
            megaLuck: {
                name: "Mega Lucky",
                description: "Double luck effectiveness",
                level: 0,
                baseCost: 500000,
                costMultiplier: 3.0,
                icon: "üåü"
            },
            goldRush: {
                name: "Gold Rush",
                description: "+10% gold ore chance per level",
                level: 0,
                baseCost: 250000,
                costMultiplier: 2.5,
                icon: "ü•á"
            },
            diamondFinder: {
                name: "Diamond Finder",
                description: "+5% diamond spawn chance per level",
                level: 0,
                baseCost: 1000000,
                costMultiplier: 3.0,
                icon: "üíé"
            },
            speedDig: {
                name: "Speed Dig",
                description: "Workers mine 10% faster per level",
                level: 0,
                baseCost: 75000,
                costMultiplier: 2.2,
                icon: "üèÉ"
            },
            workerEfficiency: {
                name: "Worker Training",
                description: "Workers collect 15% more per level",
                level: 0,
                baseCost: 150000,
                costMultiplier: 2.3,
                icon: "üéì"
            },
            magneticOre: {
                name: "Ore Magnet",
                description: "Workers move towards ores faster",
                level: 0,
                baseCost: 80000,
                costMultiplier: 2.0,
                icon: "üß≤"
            },
            multiStrike: {
                name: "Multi-Strike",
                description: "Chance to mine 2 ores at once",
                level: 0,
                baseCost: 300000,
                costMultiplier: 2.8,
                icon: "‚öîÔ∏è"
            },
            treasureHunter: {
                name: "Treasure Hunter",
                description: "Rare bonus money drops",
                level: 0,
                baseCost: 200000,
                costMultiplier: 2.5,
                icon: "üí∞"
            },
            depthMaster: {
                name: "Depth Master",
                description: "+50 depth per auto-dig tick",
                level: 0,
                baseCost: 400000,
                costMultiplier: 2.6,
                icon: "üï≥Ô∏è"
            },
            oreMultiplier: {
                name: "Ore Duplicator",
                description: "5% chance to double ore value",
                level: 0,
                baseCost: 600000,
                costMultiplier: 3.0,
                icon: "‚ú®"
            },
            superCrit: {
                name: "Super Critical",
                description: "Crits deal 10x instead of 5x",
                level: 0,
                baseCost: 2000000,
                costMultiplier: 4.0,
                icon: "üí•"
            },
            autoCollector: {
                name: "Auto Collector",
                description: "Automatically collect 1 ore per second",
                level: 0,
                baseCost: 500000,
                costMultiplier: 3.5,
                icon: "ü§ü"
            },
            bonusWorker: {
                name: "Bonus Workers",
                description: "Each worker type can hire +10 more",
                level: 0,
                baseCost: 1000000,
                costMultiplier: 4.0,
                icon: "üë∑"
            },
            eliteChance: {
                name: "Elite Training",
                description: "+0.5% Hakari spawn chance per level",
                level: 0,
                baseCost: 5000000,
                costMultiplier: 3.5,
                icon: "üëë"
            },
            passiveIncome: {
                name: "Passive Income",
                description: "Earn $100 per second per level",
                level: 0,
                baseCost: 50000,
                costMultiplier: 1.8,
                icon: "üíµ"
            },
            meteorShower: {
                name: "Meteor Shower",
                description: "Rare ores fall from the sky",
                level: 0,
                baseCost: 750000,
                costMultiplier: 3.0,
                icon: "‚òÑÔ∏è"
            },
            quantumMining: {
                name: "Quantum Mining",
                description: "Mining affects parallel universes (+$)",
                level: 0,
                baseCost: 10000000,
                costMultiplier: 4.0,
                icon: "üåå"
            },
            timeWarp: {
                name: "Time Warp",
                description: "Auto-dig triggers 2x as often",
                level: 0,
                baseCost: 3000000,
                costMultiplier: 4.5,
                icon: "‚è∞"
            },
            fortuneBlessing: {
                name: "Fortune Blessing",
                description: "+50% luck per level",
                level: 0,
                baseCost: 800000,
                costMultiplier: 3.2,
                icon: "üåà"
            },
            miningDrone: {
                name: "Mining Drone",
                description: "Free auto-miner every 10 seconds",
                level: 0,
                baseCost: 1500000,
                costMultiplier: 3.0,
                icon: "üõ©Ô∏è"
            },
            explosiveDig: {
                name: "Explosive Dig",
                description: "Each dig has 10% chance to spawn 3 ores",
                level: 0,
                baseCost: 400000,
                costMultiplier: 2.5,
                icon: "üí£"
            },
            oreRadar: {
                name: "Ore Radar",
                description: "See ore values before mining",
                level: 0,
                baseCost: 100000,
                costMultiplier: 2.0,
                icon: "üì±"
            },
            silverSurge: {
                name: "Silver Surge",
                description: "+15% silver ore spawn",
                level: 0,
                baseCost: 150000,
                costMultiplier: 2.2,
                icon: "ü•à"
            },
            platinumPlunge: {
                name: "Platinum Plunge",
                description: "+8% platinum ore spawn",
                level: 0,
                baseCost: 500000,
                costMultiplier: 2.8,
                icon: "‚≠ê"
            },
            cosmicLuck: {
                name: "Cosmic Luck",
                description: "Triple luck on full moons (always)",
                level: 0,
                baseCost: 5000000,
                costMultiplier: 5.0,
                icon: "üåï"
            },
            oreStorm: {
                name: "Ore Storm",
                description: "Spawn 5 random ores every 30 seconds",
                level: 0,
                baseCost: 2000000,
                costMultiplier: 3.5,
                icon: "üå©Ô∏è"
            },
            goldenTouch: {
                name: "Golden Touch",
                description: "10% of ores turn to gold",
                level: 0,
                baseCost: 3000000,
                costMultiplier: 4.0,
                icon: "ü§ö"
            },
            hyperDrill: {
                name: "Hyper Drill",
                description: "+100 depth per dig",
                level: 0,
                baseCost: 1000000,
                costMultiplier: 3.0,
                icon: "üõ†Ô∏è"
            },
            gemPolisher: {
                name: "Gem Polisher",
                description: "Gems worth 20% more per level",
                level: 0,
                baseCost: 750000,
                costMultiplier: 2.5,
                icon: "üíÖ"
            },
            mineCart: {
                name: "Mine Cart",
                description: "Auto-collect ores when full",
                level: 0,
                baseCost: 600000,
                costMultiplier: 2.8,
                icon: "üö∑"
            },
            reinforcedShovel: {
                name: "Reinforced Shovel",
                description: "+2 power per level",
                level: 0,
                baseCost: 200000,
                costMultiplier: 2.0,
                icon: "ü™®"
            },
            titaniumPickaxe: {
                name: "Titanium Pickaxe",
                description: "Break through harder layers",
                level: 0,
                baseCost: 2500000,
                costMultiplier: 3.5,
                icon: "‚õèÔ∏è"
            },
            luckyStrike: {
                name: "Lucky Strike",
                description: "Crits have +20% luck bonus",
                level: 0,
                baseCost: 1200000,
                costMultiplier: 3.0,
                icon: "üéØ"
            },
            doubleDown: {
                name: "Double Down",
                description: "5% chance for double money",
                level: 0,
                baseCost: 800000,
                costMultiplier: 3.0,
                icon: "üé≤"
            },
            oreVision: {
                name: "Ore Vision",
                description: "Highlight rare ores on screen",
                level: 0,
                baseCost: 300000,
                costMultiplier: 2.5,
                icon: "üëÅÔ∏è"
            },
            rebirthBoost: {
                name: "Rebirth Boost",
                description: "+10% rebirth multiplier per level",
                level: 0,
                baseCost: 10000000,
                costMultiplier: 5.0,
                icon: "üîÑ"
            },
            worldHopper: {
                name: "World Hopper",
                description: "Access previous world ores",
                level: 0,
                baseCost: 50000000,
                costMultiplier: 10.0,
                icon: "üåç"
            },
            infinityGem: {
                name: "Infinity Gem",
                description: "+1% to all stats per level",
                level: 0,
                baseCost: 100000000,
                costMultiplier: 5.0,
                icon: "üíú"
            },
            motherLode: {
                name: "Mother Lode",
                description: "Huge ore spawns occasionally",
                level: 0,
                baseCost: 5000000,
                costMultiplier: 4.0,
                icon: "üè¶"
            },
            chainReaction: {
                name: "Chain Reaction",
                description: "Mining one ore may trigger nearby",
                level: 0,
                baseCost: 3000000,
                costMultiplier: 3.5,
                icon: "üîó"
            },
            luckyWorkers: {
                name: "Lucky Workers",
                description: "Workers get luck bonuses too",
                level: 0,
                baseCost: 2000000,
                costMultiplier: 3.0,
                icon: "üçÄ"
            },
            overcharge: {
                name: "Overcharge",
                description: "Shovel power x2 for 5 seconds",
                level: 0,
                baseCost: 1500000,
                costMultiplier: 3.5,
                icon: "üîã"
            },
            richVein: {
                name: "Rich Vein",
                description: "Ores spawn in clusters",
                level: 0,
                baseCost: 4000000,
                costMultiplier: 4.0,
                icon: "üå±"
            },
            ancientRelic: {
                name: "Ancient Relic",
                description: "Find ancient artifacts worth millions",
                level: 0,
                baseCost: 20000000,
                costMultiplier: 5.0,
                icon: "üè∫"
            },
            turboWorkers: {
                name: "Turbo Workers",
                description: "All workers 25% faster",
                level: 0,
                baseCost: 8000000,
                costMultiplier: 4.5,
                icon: "üöÄ"
            },
            oreRefineryPlus: {
                name: "Refinery+",
                description: "All ore values +50%",
                level: 0,
                baseCost: 15000000,
                costMultiplier: 5.0,
                icon: "üè≠"
            },
            stardustCollector: {
                name: "Stardust Collector",
                description: "Collect stardust for bonus money",
                level: 0,
                baseCost: 25000000,
                costMultiplier: 5.0,
                icon: "‚≠ê"
            },
            voidMiner: {
                name: "Void Miner",
                description: "Mine the void for rare finds",
                level: 0,
                baseCost: 50000000,
                costMultiplier: 6.0,
                icon: "üï≥Ô∏è"
            },
            omegaLuck: {
                name: "Omega Luck",
                description: "Luck affects everything x2",
                level: 0,
                baseCost: 100000000,
                costMultiplier: 8.0,
                icon: "Œ©"
            },
            ultimateShovel: {
                name: "Ultimate Shovel",
                description: "The final shovel upgrade",
                level: 0,
                baseCost: 500000000,
                costMultiplier: 10.0,
                icon: "üëë"
            }
        };

        // 27 Ore Types (Extremely rare high-tier ores)
        const oreTypes = [
            // Common (World 1+)
            { name: "Dirt", color: "#8B7355", value: 5, minDepth: 0, rarity: 1000, worldMin: 0 },
            { name: "Clay", color: "#a0522d", value: 10, minDepth: 5, rarity: 800, worldMin: 0 },
            { name: "Stone", color: "#708090", value: 25, minDepth: 15, rarity: 600, worldMin: 0 },
            { name: "Granite", color: "#bc8f8f", value: 50, minDepth: 30, rarity: 400, worldMin: 0 },
            { name: "Coal", color: "#2f2f2f", value: 100, minDepth: 50, rarity: 250, worldMin: 0 },
            { name: "Sandstone", color: "#c2b280", value: 150, minDepth: 75, rarity: 200, worldMin: 0 },
            
            // Uncommon (World 1+)
            { name: "Copper", color: "#b87333", value: 250, minDepth: 100, rarity: 150, worldMin: 0 },
            { name: "Tin", color: "#d3d3d3", value: 500, minDepth: 200, rarity: 100, worldMin: 0 },
            { name: "Lead", color: "#5c5c5c", value: 750, minDepth: 275, rarity: 85, worldMin: 0 },
            { name: "Iron", color: "#434343", value: 1000, minDepth: 350, rarity: 70, worldMin: 0 },
            { name: "Nickel", color: "#727472", value: 1500, minDepth: 425, rarity: 55, worldMin: 0 },
            { name: "Zinc", color: "#bac4c8", value: 2000, minDepth: 500, rarity: 45, worldMin: 0 },
            { name: "Cobalt", color: "#0047ab", value: 3000, minDepth: 600, rarity: 35, worldMin: 0 },
            
            // Rare (World 1+)
            { name: "Silver", color: "#c0c0c0", value: 5000, minDepth: 750, rarity: 25, worldMin: 0 },
            { name: "Tungsten", color: "#575757", value: 8000, minDepth: 1000, rarity: 18, worldMin: 0 },
            { name: "Gold", color: "#ffd700", value: 12000, minDepth: 1200, rarity: 12, worldMin: 0 },
            { name: "Palladium", color: "#ced0dd", value: 20000, minDepth: 1600, rarity: 8, worldMin: 0 },
            { name: "Platinum", color: "#e5e4e2", value: 30000, minDepth: 2000, rarity: 6, worldMin: 0 },
            { name: "Rhodium", color: "#e8e8e8", value: 50000, minDepth: 2500, rarity: 4, worldMin: 0 },
            { name: "Osmium", color: "#464d5c", value: 75000, minDepth: 3000, rarity: 3, worldMin: 0 },
            { name: "Iridium", color: "#b8b8b8", value: 100000, minDepth: 3500, rarity: 2.5, worldMin: 0 },
            { name: "Rhenium", color: "#9999cc", value: 150000, minDepth: 4000, rarity: 2, worldMin: 0 },
            
            // Very Rare (World 2+)
            { name: "Ruby", color: "#e0115f", value: 30000, minDepth: 500, rarity: 4, worldMin: 1 },
            { name: "Sapphire", color: "#0f52ba", value: 50000, minDepth: 800, rarity: 3, worldMin: 1 },
            { name: "Emerald", color: "#50c878", value: 80000, minDepth: 1200, rarity: 2.5, worldMin: 1 },
            
            // Epic (World 3+)
            { name: "Diamond", color: "#b9f2ff", value: 200000, minDepth: 500, rarity: 2, worldMin: 2 },
            { name: "Amethyst", color: "#9966cc", value: 400000, minDepth: 1000, rarity: 1.5, worldMin: 2 },
            { name: "Opal", color: "#a8c3bc", value: 750000, minDepth: 2000, rarity: 1, worldMin: 2 },
            
            // Legendary (World 4+)
            { name: "Mythril", color: "#4169e1", value: 2000000, minDepth: 500, rarity: 0.8, worldMin: 3 },
            { name: "Adamantite", color: "#dc143c", value: 5000000, minDepth: 1500, rarity: 0.5, worldMin: 3 },
            { name: "Titanium", color: "#878681", value: 10000000, minDepth: 3000, rarity: 0.3, worldMin: 3 },
            
            // Mythic (World 5+)
            { name: "Unobtainium", color: "#ff00ff", value: 50000000, minDepth: 1000, rarity: 0.15, worldMin: 4 },
            { name: "Eternium", color: "#00ffff", value: 150000000, minDepth: 2500, rarity: 0.08, worldMin: 4 },
            
            // Cosmic (World 6+)
            { name: "Dark Matter", color: "#1a0033", value: 500000000, minDepth: 1000, rarity: 0.04, worldMin: 5 },
            { name: "Neutronium", color: "#ff6600", value: 2000000000, minDepth: 3000, rarity: 0.02, worldMin: 5 },
            
            // Transcendent (World 7+)
            { name: "Quantum Crystal", color: "#00ff88", value: 10000000000, minDepth: 500, rarity: 0.01, worldMin: 6 },
            { name: "Infinity Shard", color: "#ff1493", value: 100000000000, minDepth: 2000, rarity: 0.003, worldMin: 6 },
            
            // Ultimate (World 8)
            { name: "Reality Fragment", color: "#ffffff", value: 1000000000000, minDepth: 1000, rarity: 0.001, worldMin: 7 },
            
            // Obsidian Abyss (World 9)
            { name: "Void Essence", color: "#1a1a2a", value: 5000000000000, minDepth: 500, rarity: 0.008, worldMin: 8 },
            { name: "Shadow Crystal", color: "#2a2a4a", value: 15000000000000, minDepth: 1500, rarity: 0.005, worldMin: 8 },
            { name: "Obsidian Heart", color: "#0a0a0a", value: 50000000000000, minDepth: 2500, rarity: 0.002, worldMin: 8 },
            
            // Crystalline Aurora (World 10)
            { name: "Frost Shard", color: "#66ffff", value: 100000000000000, minDepth: 600, rarity: 0.007, worldMin: 9 },
            { name: "Aurora Crystal", color: "#00ffff", value: 300000000000000, minDepth: 1800, rarity: 0.004, worldMin: 9 },
            { name: "Eternal Ice", color: "#88ffff", value: 1000000000000000, minDepth: 3000, rarity: 0.0015, worldMin: 9 },
            
            // Volcanic Inferno (World 11)
            { name: "Magma Ore", color: "#ff4400", value: 2000000000000000, minDepth: 700, rarity: 0.006, worldMin: 10 },
            { name: "Infernal Ruby", color: "#ff0000", value: 5000000000000000, minDepth: 2000, rarity: 0.0035, worldMin: 10 },
            { name: "Lava Condensed", color: "#ff6600", value: 15000000000000000, minDepth: 3500, rarity: 0.001, worldMin: 10 },
            
            // Twilight Gardens (World 12)
            { name: "Twilight Gem", color: "#cc88ff", value: 40000000000000000, minDepth: 800, rarity: 0.005, worldMin: 11 },
            { name: "Enchanted Prism", color: "#aa66ff", value: 120000000000000000, minDepth: 2200, rarity: 0.003, worldMin: 11 },
            { name: "Ethereal Essence", color: "#dd99ff", value: 400000000000000000, minDepth: 3800, rarity: 0.0008, worldMin: 11 },
            
            // Metallic Dimension (World 13)
            { name: "Pure Steel", color: "#cccccc", value: 1000000000000000000, minDepth: 900, rarity: 0.004, worldMin: 12 },
            { name: "Mithril Alloy", color: "#888888", value: 3000000000000000000, minDepth: 2400, rarity: 0.0025, worldMin: 12 },
            { name: "Dimensional Metal", color: "#999999", value: 10000000000000000000, minDepth: 4000, rarity: 0.0006, worldMin: 12 },
            
            // Enchanted Forest (World 14)
            { name: "Moonstone Crystal", color: "#aaffff", value: 25000000000000000000, minDepth: 1000, rarity: 0.0035, worldMin: 13 },
            { name: "Verdant Gem", color: "#66ff66", value: 75000000000000000000, minDepth: 2600, rarity: 0.002, worldMin: 13 },
            { name: "Life Essence", color: "#00ff88", value: 250000000000000000000, minDepth: 4200, rarity: 0.0005, worldMin: 13 },
            
            // Temporal Vortex (World 15)
            { name: "Chrono Fragment", color: "#ff88ff", value: 1000000000000000000000, minDepth: 1100, rarity: 0.003, worldMin: 14 },
            { name: "Time Crystal", color: "#ff00ff", value: 3000000000000000000000, minDepth: 2800, rarity: 0.0015, worldMin: 14 },
            { name: "Temporal Anomaly", color: "#ff55ff", value: 10000000000000000000000, minDepth: 4400, rarity: 0.0004, worldMin: 14 },
            
            // Celestial Haven (World 16)
            { name: "Solar Ore", color: "#ffff44", value: 50000000000000000000000, minDepth: 1200, rarity: 0.0025, worldMin: 15 },
            { name: "Celestial Pearl", color: "#ffff99", value: 150000000000000000000000, minDepth: 3000, rarity: 0.001, worldMin: 15 },
            { name: "Stellar Core", color: "#ffff00", value: 500000000000000000000000, minDepth: 4600, rarity: 0.0003, worldMin: 15 },
            
            // Abyssal Trench (World 17)
            { name: "Deep Sea Pearl", color: "#0088ff", value: 2000000000000000000000000, minDepth: 1300, rarity: 0.002, worldMin: 16 },
            { name: "Abyss Gem", color: "#0055ff", value: 6000000000000000000000000, minDepth: 3200, rarity: 0.0008, worldMin: 16 },
            { name: "Trenchstone", color: "#003388", value: 20000000000000000000000000, minDepth: 4800, rarity: 0.0002, worldMin: 16 },
            
            // Sanctum of Light (World 18)
            { name: "Divine Crystal", color: "#ffffcc", value: 100000000000000000000000000, minDepth: 1400, rarity: 0.0015, worldMin: 17 },
            { name: "Holy Shard", color: "#ffff99", value: 300000000000000000000000000, minDepth: 3400, rarity: 0.0006, worldMin: 17 },
            { name: "Light Fragment", color: "#ffff66", value: 1000000000000000000000000000, minDepth: 5000, rarity: 0.0001, worldMin: 17 },
            
            // Void Nexus (World 19)
            { name: "Void Shard", color: "#111122", value: 5000000000000000000000000000, minDepth: 1500, rarity: 0.001, worldMin: 18 },
            { name: "Null Crystal", color: "#0a0a0a", value: 15000000000000000000000000000, minDepth: 3600, rarity: 0.0004, worldMin: 18 },
            { name: "Nexus Core", color: "#1a1a2a", value: 50000000000000000000000000000, minDepth: 5200, rarity: 0.00005, worldMin: 18 },
            
            // Chromatic Realm (World 20)
            { name: "Rainbow Gem", color: "#ff7777", value: 300000000000000000000000000000, minDepth: 1600, rarity: 0.0008, worldMin: 19 },
            { name: "Spectral Shard", color: "#77ff77", value: 1000000000000000000000000000000, minDepth: 3800, rarity: 0.0003, worldMin: 19 },
            { name: "Chromatic Essence", color: "#7777ff", value: 3000000000000000000000000000000, minDepth: 5400, rarity: 0.00002, worldMin: 19 },
            
            // Primordial Chaos (World 21)
            { name: "Chaos Shard", color: "#884488", value: 15000000000000000000000000000000, minDepth: 1700, rarity: 0.0005, worldMin: 20 },
            { name: "Primordial Ore", color: "#ff0088", value: 50000000000000000000000000000000, minDepth: 4000, rarity: 0.0002, worldMin: 20 },
            { name: "Origin Fragment", color: "#008888", value: 1000000000000000000000000000000000, minDepth: 5600, rarity: 0.00001, worldMin: 20 }
        ];

        const REBIRTH_COST = 1000000000; // 1 Billion
        
        // Skill tier costs (money)
        const SKILL_TIER_COSTS = [
            1000000,       // Tier 1: 1M
            10000000,      // Tier 2: 10M
            100000000,     // Tier 3: 100M
            5000000000,    // Tier 4: 5B
            100000000000   // Tier 5: 100B
        ];

        // Skill Tree Paths - Each path has 5 tiers, each tier has 3 choices (pick 1)
        const skillPaths = [
            {
                name: "Power Path",
                icon: "‚öîÔ∏è",
                description: "Raw mining strength",
                color: "#e74c3c",
                tiers: [
                    [
                        { name: "Mighty Swing", icon: "üí™", effect: "2x base dig power", bonus: { type: 'digPower', mult: 2 } },
                        { name: "Heavy Hands", icon: "ü§ú", effect: "3x depth per dig", bonus: { type: 'depthMult', mult: 3 } },
                        { name: "Earth Shatter", icon: "üí•", effect: "+50% ore spawn on dig", bonus: { type: 'oreSpawnChance', add: 0.5 } }
                    ],
                    [
                        { name: "Titan Strength", icon: "ü¶æ", effect: "Another 3x dig power", bonus: { type: 'digPower', mult: 3 } },
                        { name: "Quake Strike", icon: "üåã", effect: "Dig spawns 2 ores", bonus: { type: 'orePerDig', add: 1 } },
                        { name: "Deep Impact", icon: "‚¨áÔ∏è", effect: "5x depth per dig", bonus: { type: 'depthMult', mult: 5 } }
                    ],
                    [
                        { name: "Colossus", icon: "üóø", effect: "5x all ore values", bonus: { type: 'oreValue', mult: 5 } },
                        { name: "Berserker", icon: "üò§", effect: "10x dig power", bonus: { type: 'digPower', mult: 10 } },
                        { name: "Avalanche", icon: "üèîÔ∏è", effect: "Each dig spawns 3 ores", bonus: { type: 'orePerDig', add: 2 } }
                    ],
                    [
                        { name: "World Breaker", icon: "üåç", effect: "25x dig power", bonus: { type: 'digPower', mult: 25 } },
                        { name: "Ore Mastery", icon: "üíé", effect: "20x ore values", bonus: { type: 'oreValue', mult: 20 } },
                        { name: "Endless Depth", icon: "üï≥Ô∏è", effect: "20x depth per dig", bonus: { type: 'depthMult', mult: 20 } }
                    ],
                    [
                        { name: "GOD OF MINING", icon: "üëë", effect: "100x EVERYTHING", bonus: { type: 'godMode', mult: 100 } },
                        { name: "INFINITE POWER", icon: "‚ôæÔ∏è", effect: "1000x dig power", bonus: { type: 'digPower', mult: 1000 } },
                        { name: "ORE LORD", icon: "üèÜ", effect: "100x ore values, 5 ores/dig", bonus: { type: 'oreLord', mult: 100, ores: 5 } }
                    ]
                ]
            },
            {
                name: "Luck Path",
                icon: "üçÄ",
                description: "Fortune favors you",
                color: "#27ae60",
                tiers: [
                    [
                        { name: "Lucky Find", icon: "üé≤", effect: "2x luck stat", bonus: { type: 'luck', mult: 2 } },
                        { name: "Treasure Sense", icon: "üîÆ", effect: "Rare ores +50% common", bonus: { type: 'rareChance', add: 0.5 } },
                        { name: "Golden Touch", icon: "‚ú®", effect: "10% chance 5x money", bonus: { type: 'moneyChance', chance: 0.1, mult: 5 } }
                    ],
                    [
                        { name: "Fortune's Child", icon: "üåü", effect: "3x luck stat", bonus: { type: 'luck', mult: 3 } },
                        { name: "Jackpot", icon: "üé∞", effect: "5% chance 20x money", bonus: { type: 'moneyChance', chance: 0.05, mult: 20 } },
                        { name: "Ore Magnet", icon: "üß≤", effect: "2x rare ore spawns", bonus: { type: 'rareChance', add: 1 } }
                    ],
                    [
                        { name: "Blessed", icon: "üòá", effect: "5x luck stat", bonus: { type: 'luck', mult: 5 } },
                        { name: "Midas Touch", icon: "üëÜ", effect: "All ores worth 3x more", bonus: { type: 'oreValue', mult: 3 } },
                        { name: "Fate's Favor", icon: "üéØ", effect: "10% chance 50x money", bonus: { type: 'moneyChance', chance: 0.1, mult: 50 } }
                    ],
                    [
                        { name: "Cosmic Luck", icon: "üåå", effect: "10x luck, best ores", bonus: { type: 'luck', mult: 10 } },
                        { name: "Rainbow Ore", icon: "üåà", effect: "All ores 10x value", bonus: { type: 'oreValue', mult: 10 } },
                        { name: "Wish Granter", icon: "üßû", effect: "15% chance 100x money", bonus: { type: 'moneyChance', chance: 0.15, mult: 100 } }
                    ],
                    [
                        { name: "LUCK GOD", icon: "üé™", effect: "50x luck, 5x all ores", bonus: { type: 'luckGod', luckMult: 50, oreMult: 5 } },
                        { name: "INFINITE FORTUNE", icon: "üí∞", effect: "25% chance 500x money", bonus: { type: 'moneyChance', chance: 0.25, mult: 500 } },
                        { name: "DESTINY", icon: "‚≠ê", effect: "Only rare+ ores spawn", bonus: { type: 'onlyRare', minRarity: 10 } }
                    ]
                ]
            },
            {
                name: "Auto Path",
                icon: "ü§ñ",
                description: "Passive income master",
                color: "#3498db",
                tiers: [
                    [
                        { name: "Quick Hands", icon: "‚ö°", effect: "2x auto-dig speed", bonus: { type: 'autoSpeed', mult: 2 } },
                        { name: "Ore Rain", icon: "üåßÔ∏è", effect: "Auto spawns +2 ores/s", bonus: { type: 'autoOres', add: 2 } },
                        { name: "Passive Gains", icon: "üìà", effect: "Auto earns +$100/s base", bonus: { type: 'passiveIncome', add: 100 } }
                    ],
                    [
                        { name: "Turbo Mode", icon: "üöÄ", effect: "3x auto-dig speed", bonus: { type: 'autoSpeed', mult: 3 } },
                        { name: "Ore Factory", icon: "üè≠", effect: "Auto spawns +5 ores/s", bonus: { type: 'autoOres', add: 5 } },
                        { name: "Money Printer", icon: "üñ®Ô∏è", effect: "Auto earns +$1000/s", bonus: { type: 'passiveIncome', add: 1000 } }
                    ],
                    [
                        { name: "Lightning Fast", icon: "‚ö°", effect: "5x auto-dig speed", bonus: { type: 'autoSpeed', mult: 5 } },
                        { name: "Ore Storm", icon: "üå™Ô∏è", effect: "Auto spawns +10 ores/s", bonus: { type: 'autoOres', add: 10 } },
                        { name: "Bank Interest", icon: "üè¶", effect: "+0.1% money per second", bonus: { type: 'interest', rate: 0.001 } }
                    ],
                    [
                        { name: "Time Warp", icon: "‚è∞", effect: "10x auto-dig speed", bonus: { type: 'autoSpeed', mult: 10 } },
                        { name: "Ore Tsunami", icon: "üåä", effect: "Auto spawns +25 ores/s", bonus: { type: 'autoOres', add: 25 } },
                        { name: "Compound Int.", icon: "üìä", effect: "+1% money per second", bonus: { type: 'interest', rate: 0.01 } }
                    ],
                    [
                        { name: "AFK MASTER", icon: "üò¥", effect: "50x auto speed, +100 ores/s", bonus: { type: 'afkMaster', speedMult: 50, ores: 100 } },
                        { name: "MONEY MACHINE", icon: "üíµ", effect: "+10% money per second", bonus: { type: 'interest', rate: 0.1 } },
                        { name: "SINGULARITY", icon: "üîÑ", effect: "Auto-collects all ores", bonus: { type: 'autoCollect', enabled: true } }
                    ]
                ]
            }
        ];

        // Initialize
        function init() {
            // Show main menu instead of auto-starting
            showMainMenu();
        }
        
        // Load skins from localStorage
        function loadSkinsData() {
            try {
                const savedSkins = localStorage.getItem('ownedSkins');
                if (savedSkins) {
                    ownedSkins = JSON.parse(savedSkins);
                }
                
                const savedSelected = localStorage.getItem('selectedSkin');
                if (savedSelected) {
                    selectedSkin = savedSelected;
                }
                
                updateShovelEmoji();
            } catch (e) {
                console.error('Failed to load skins data:', e);
            }
        }

        // Silent auto-load (no alerts)
        function autoLoadGame() {
            try {
                const lastSlot = localStorage.getItem('lastUsedSlot') || '1';
                const savedData = localStorage.getItem(`diggingGameSave_${lastSlot}`);
                if (!savedData) return;
                
                const saveData = JSON.parse(savedData);
                
                money = saveData.money || 0;
                depth = saveData.depth || 0;
                rebirths = saveData.rebirths || 0;
                currentWorld = saveData.currentWorld || 0;
                chosenPath = saveData.chosenPath;
                pathProgress = saveData.pathProgress || {};
                workerCounts = saveData.workerCounts || { broke: 0, basic: 0, fast: 0, strong: 0, elite: 0, strongest: 0, sukuna: 0 };
                
                if (saveData.upgrades) {
                    for (const [key, level] of Object.entries(saveData.upgrades)) {
                        if (upgrades[key]) upgrades[key].level = level;
                    }
                }
                
                // Spawn workers based on saved counts
                for (const [workerId, count] of Object.entries(workerCounts)) {
                    for (let i = 0; i < count; i++) {
                        setTimeout(() => spawnWorker(workerId), 100);
                    }
                }
                
                console.log('Game auto-loaded from save');
            } catch (e) {
                console.error('Auto-load failed:', e);
            }
        }

        // Make shovel follow mouse
        function initShovelTracking() {
            const miningArea = document.getElementById('mining-area');
            const shovel = document.getElementById('shovel');
            
            // Position shovel at center initially
            shovel.style.left = '50%';
            shovel.style.top = '50%';
            shovel.style.transform = 'translate(-50%, -50%)';
            
            miningArea.addEventListener('mousemove', (e) => {
                const rect = miningArea.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                shovel.style.left = x + 'px';
                shovel.style.top = y + 'px';
                shovel.style.transform = 'translate(-50%, -50%)';
            });
            
            miningArea.addEventListener('mouseleave', () => {
                shovel.style.left = '50%';
                shovel.style.top = '50%';
                shovel.style.transform = 'translate(-50%, -50%)';
            });
        }

        function updateWorldVisuals() {
            const world = worlds[currentWorld];
            document.body.style.background = world.bg;
            document.getElementById('mining-area').style.background = world.miningBg;
            
            // Update surface layer
            const surfaceLayer = document.getElementById('surface-layer');
            surfaceLayer.style.background = world.surfaceBg;
            document.getElementById('surface-emoji').textContent = world.surfaceEmoji;
        }

        function renderOreLegend() {
            const legend = document.getElementById('ore-legend');
            const availableOres = oreTypes.filter(ore => ore.worldMin <= currentWorld);
            
            legend.innerHTML = availableOres.map(ore => `
                <div class="ore-item">
                    <div class="ore-sample" style="background: ${ore.color};"></div>
                    ${ore.name}: $${formatNumber(ore.value)}
                </div>
            `).join('');
        }

        // Generate ores in the mining area
        function generateOres() {
            const miningArea = document.getElementById('dirt-layer');
            // Only remove ores, not workers
            ores.forEach(ore => {
                if (ore && ore.parentNode) ore.remove();
            });
            ores = [];

            const baseOres = 5 + Math.floor(upgrades.oreSpawn.level * 0.5);
            for (let i = 0; i < baseOres; i++) {
                spawnOre();
            }
        }

        function spawnOre() {
            const miningArea = document.getElementById('dirt-layer');
            const depthBonus = upgrades.depthBonus.level * 50;
            const skillBonuses = getSkillBonuses();
            const luckBonus = (1 + (upgrades.luck.level - 1) * 0.25) * skillBonuses.luckMult;

            // Filter ores by world and depth
            let availableOres = oreTypes.filter(ore => {
                if (ore.worldMin > currentWorld) return false;
                const adjustedMinDepth = Math.max(0, ore.minDepth - depthBonus);
                if (depth < adjustedMinDepth) return false;
                
                // Depth-based ore restrictions
                if (depth >= 1000 && ore.name === "Dirt") return false;
                if (depth >= 5000 && ore.name === "Stone") return false;
                if (depth >= 10000 && ore.value < 1000) return false; // Only Iron+ (value 1000+)
                
                return true;
            });
            
            // Skill: Only rare ores mode
            if (skillBonuses.onlyRare) {
                availableOres = availableOres.filter(ore => ore.rarity <= skillBonuses.minRarity);
                if (availableOres.length === 0) {
                    availableOres = oreTypes.filter(ore => ore.worldMin <= currentWorld).slice(-5);
                }
            }

            // Weighted random selection (rarer = harder to get, but luck helps)
            const rareChanceBoost = 1 + skillBonuses.rareChance;
            let totalRarity = availableOres.reduce((sum, ore) => {
                const rarityBoost = ore.value > 1000 ? luckBonus * rareChanceBoost : 1;
                return sum + ore.rarity * rarityBoost;
            }, 0);
            
            let random = Math.random() * totalRarity;
            let selectedOre = availableOres[0];

            for (const ore of availableOres) {
                const rarityBoost = ore.value > 1000 ? luckBonus * rareChanceBoost : 1;
                const adjustedRarity = ore.rarity * rarityBoost;
                if (random <= adjustedRarity) {
                    selectedOre = ore;
                    break;
                }
                random -= adjustedRarity;
            }

            const oreElement = document.createElement('div');
            oreElement.className = 'ore';
            oreElement.style.background = selectedOre.color;
            oreElement.style.color = selectedOre.value > 1000 ? '#000' : '#fff';
            oreElement.style.left = Math.random() * 85 + 5 + '%';
            oreElement.style.top = Math.random() * 75 + 5 + '%';
            // Vary ore size slightly and rotate for more natural look
            const sizeVariation = 0.85 + Math.random() * 0.3; // 85% to 115% size
            oreElement.style.transform = `scale(${sizeVariation}) rotate(${Math.random() * 360}deg)`;
            oreElement.textContent = selectedOre.name.substring(0, 2);
            oreElement.dataset.value = selectedOre.value;
            oreElement.dataset.name = selectedOre.name;
            oreElement.onclick = (e) => {
                e.stopPropagation();
                mineOre(oreElement, selectedOre);
            };

            miningArea.appendChild(oreElement);
            ores.push(oreElement);
        }

        // Get total multiplier
        function getTotalMultiplier() {
            const rebirthMult = Math.pow(1.5, rebirths);
            const worldMult = worlds[currentWorld].multiplier;
            const oreMult = upgrades.oreValue.level;
            const skillBonuses = getSkillBonuses();
            return rebirthMult * worldMult * oreMult * skillBonuses.oreValueMult;
        }

        // Mine an ore
        function mineOre(oreElement, oreData) {
            const rect = oreElement.getBoundingClientRect();
            const baseValue = parseInt(oreElement.dataset.value);
            const skillBonuses = getSkillBonuses();
            
            let earnedMoney = Math.floor(baseValue * upgrades.shovelPower.level * skillBonuses.digPowerMult * getTotalMultiplier());
            
            // Critical hit check
            if (upgrades.critChance.level > 0 && Math.random() < upgrades.critChance.level * 0.03) {
                earnedMoney *= 5;
            }
            
            // Skill money chance bonuses
            for (const mc of skillBonuses.moneyChances) {
                if (Math.random() < mc.chance) {
                    earnedMoney *= mc.mult;
                    break; // Only apply one bonus
                }
            }
            
            addMoney(earnedMoney, rect.left + 22, rect.top);
            
            // Remove ore
            oreElement.remove();
            const index = ores.indexOf(oreElement);
            if (index > -1) ores.splice(index, 1);
            
            depth += upgrades.shovelPower.level * skillBonuses.depthMult;
            updateDisplay();
            animateShovel();
            
            // Chance to spawn a new ore after mining one
            const oreSpawnBonus = skillBonuses.oreSpawnChance;
            if (Math.random() < 0.5 + upgrades.oreSpawn.level * 0.05 + oreSpawnBonus) {
                setTimeout(spawnOre, 500);
            }
            
            // Skill: Extra ores per dig
            for (let i = 0; i < skillBonuses.orePerDig; i++) {
                setTimeout(() => spawnOre(), 300 + i * 200);
            }
            
            // Small bonus chance to spawn extra ore
            if (Math.random() < 0.1 + upgrades.oreSpawn.level * 0.03 && ores.length < 15) {
                setTimeout(spawnOre, 800);
            }
        }

        // Dig action (only spawns ores, no money)
        function dig(event) {
            const skillBonuses = getSkillBonuses();
            depth += upgrades.shovelPower.level * skillBonuses.depthMult;
            animateShovel();
            updateDisplay();
            
            // Chance to spawn ore when digging
            const oreSpawnBonus = skillBonuses.oreSpawnChance;
            if (Math.random() < 0.2 + upgrades.oreSpawn.level * 0.03 + oreSpawnBonus && ores.length < 12) {
                spawnOre();
            }
            
            // Skill: Extra ores per dig
            for (let i = 0; i < skillBonuses.orePerDig; i++) {
                setTimeout(() => spawnOre(), 100 + i * 150);
            }
            
            // Guarantee spawn if too few ores
            if (ores.length < 2) {
                spawnOre();
            }
        }

        // Add money with popup effect
        function addMoney(amount, x, y) {
            money += amount;
            
            const popup = document.createElement('div');
            popup.className = 'money-popup';
            popup.textContent = `+$${formatNumber(amount)}`;
            popup.style.left = x + 'px';
            popup.style.top = y + 'px';
            document.body.appendChild(popup);
            
            setTimeout(() => popup.remove(), 1000);
            
            updateDisplay();
        }

        // Animate shovel
        function animateShovel() {
            const shovel = document.getElementById('shovel');
            shovel.classList.add('digging');
            setTimeout(() => shovel.classList.remove('digging'), 150);
        }

        // Update display
        function updateDisplay() {
            document.getElementById('money').textContent = formatNumber(money);
            document.getElementById('depth').textContent = formatNumber(depth);
            document.getElementById('rebirths').textContent = rebirths;
            document.getElementById('current-world').textContent = worlds[currentWorld].name;
            
            // Update crate coins display and amount
            crateCoins = calculateCrateCoins();
            document.getElementById('crate-coins').textContent = crateCoins;
            
            document.getElementById('power-stat').textContent = upgrades.shovelPower.level;
            document.getElementById('luck-stat').textContent = (1 + (upgrades.luck.level - 1) * 0.25).toFixed(1) + 'x';
            document.getElementById('auto-stat').textContent = upgrades.autoDig.level;
            document.getElementById('ore-stat').textContent = upgrades.oreValue.level + 'x';
            document.getElementById('world-mult').textContent = worlds[currentWorld].multiplier + 'x';
            document.getElementById('rebirth-mult').textContent = Math.pow(1.5, rebirths).toFixed(1) + 'x';
            document.getElementById('rebirth-bonus').textContent = Math.pow(1.5, rebirths).toFixed(1);
            document.getElementById('workers-stat').textContent = getTotalWorkers();
            
            // Update rebirth button
            const rebirthBtn = document.getElementById('rebirth-btn');
            if (rebirthBtn) {
                rebirthBtn.disabled = money < REBIRTH_COST;
            }
            
            renderUpgrades();
            
            // Update workers modal if it's open
            if (document.getElementById('workers-modal').classList.contains('active')) {
                renderWorkers();
            }
        }

        // Format numbers (supports very large numbers)
        function formatNumber(num) {
            if (num >= 1e66) return (num / 1e66).toFixed(1) + 'Uvg';
            if (num >= 1e63) return (num / 1e63).toFixed(1) + 'Vg';
            if (num >= 1e60) return (num / 1e60).toFixed(1) + 'Nvg';
            if (num >= 1e57) return (num / 1e57).toFixed(1) + 'Ovg';
            if (num >= 1e54) return (num / 1e54).toFixed(1) + 'Svg';
            if (num >= 1e51) return (num / 1e51).toFixed(1) + 'Sxdl';
            if (num >= 1e48) return (num / 1e48).toFixed(1) + 'Qdl';
            if (num >= 1e45) return (num / 1e45).toFixed(1) + 'Qtdl';
            if (num >= 1e42) return (num / 1e42).toFixed(1) + 'Tdl';
            if (num >= 1e39) return (num / 1e39).toFixed(1) + 'Ddl';
            if (num >= 1e36) return (num / 1e36).toFixed(1) + 'Udl';
            if (num >= 1e33) return (num / 1e33).toFixed(1) + 'Dc';
            if (num >= 1e30) return (num / 1e30).toFixed(1) + 'Nn';
            if (num >= 1e27) return (num / 1e27).toFixed(1) + 'Oc';
            if (num >= 1e24) return (num / 1e24).toFixed(1) + 'Sp';
            if (num >= 1e21) return (num / 1e21).toFixed(1) + 'Sx';
            if (num >= 1e18) return (num / 1e18).toFixed(1) + 'Qi';
            if (num >= 1e15) return (num / 1e15).toFixed(1) + 'Qa';
            if (num >= 1e12) return (num / 1e12).toFixed(1) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return Math.floor(num);
        }

        // Get upgrade cost
        function getUpgradeCost(upgrade) {
            return Math.floor(upgrade.baseCost * Math.pow(upgrade.costMultiplier, upgrade.level));
        }

        // Buy upgrade
        function buyUpgrade(upgradeKey) {
            const upgrade = upgrades[upgradeKey];
            const cost = getUpgradeCost(upgrade);
            
            if (money >= cost) {
                money -= cost;
                upgrade.level++;
                updateDisplay();
                
                if (upgradeKey === 'luck' || upgradeKey === 'depthBonus' || upgradeKey === 'oreSpawn') {
                    generateOres();
                }
            }
        }

        // Render upgrades in shop
        function renderUpgrades() {
            const container = document.getElementById('upgrades-container');
            if (!container) return;
            
            // Only rebuild if not yet created
            if (container.children.length === 0) {
                for (const [key, upgrade] of Object.entries(upgrades)) {
                    const cost = getUpgradeCost(upgrade);
                    const canAfford = money >= cost;
                    
                    const item = document.createElement('div');
                    item.className = 'upgrade-item';
                    item.dataset.key = key;
                    item.innerHTML = `
                        <div class="upgrade-info">
                            <h3>${upgrade.icon} ${upgrade.name}</h3>
                            <p>${upgrade.description}</p>
                            <p class="level">Level: <span class="level-value">${upgrade.level}</span></p>
                        </div>
                        <button class="buy-btn" onclick="buyUpgrade('${key}')" ${canAfford ? '' : 'disabled'}>
                            $${formatNumber(cost)}
                        </button>
                    `;
                    container.appendChild(item);
                }
            } else {
                // Just update values without rebuilding - only change if different
                for (const [key, upgrade] of Object.entries(upgrades)) {
                    const item = container.querySelector(`[data-key="${key}"]`);
                    if (!item) continue;
                    
                    const cost = getUpgradeCost(upgrade);
                    const canAfford = money >= cost;
                    const costText = '$' + formatNumber(cost);
                    
                    const levelSpan = item.querySelector('.level-value');
                    if (levelSpan && levelSpan.textContent !== String(upgrade.level)) {
                        levelSpan.textContent = upgrade.level;
                    }
                    
                    const btn = item.querySelector('.buy-btn');
                    if (btn) {
                        if (btn.textContent !== costText) {
                            btn.textContent = costText;
                        }
                        if (btn.disabled === canAfford) {
                            btn.disabled = !canAfford;
                        }
                    }
                }
            }
        }

        // Render worlds
        function renderWorlds() {
            const container = document.getElementById('worlds-container');
            container.innerHTML = '';
            
            for (let i = 0; i < worlds.length; i++) {
                const world = worlds[i];
                const isUnlocked = rebirths >= world.rebirthCost;
                const isCurrent = i === currentWorld;
                
                const item = document.createElement('div');
                item.className = 'world-item' + (isUnlocked ? '' : ' world-locked');
                item.innerHTML = `
                    <div class="world-info">
                        <h3>${world.name}</h3>
                        <p>Multiplier: ${world.multiplier}x</p>
                        <p style="color: #ff69b4;">${world.rebirthCost === 0 ? 'Free' : `Requires ${world.rebirthCost} rebirths`}</p>
                    </div>
                    <button class="buy-btn ${isCurrent ? 'current' : ''} ${!isUnlocked ? 'locked' : ''}" 
                            onclick="selectWorld(${i})" 
                            ${!isUnlocked ? 'disabled' : ''}>
                        ${isCurrent ? '‚úì CURRENT' : (isUnlocked ? 'SELECT' : 'üîí LOCKED')}
                    </button>
                `;
                container.appendChild(item);
            }
        }

        function selectWorld(index) {
            if (rebirths >= worlds[index].rebirthCost) {
                currentWorld = index;
                updateWorldVisuals();
                renderOreLegend();
                generateOres();
                updateDisplay();
                renderWorlds();
            }
        }

        // Rebirth
        function doRebirth() {
            if (money >= REBIRTH_COST) {
                rebirths++;
                money = 0;
                depth = 0;
                
                // Reset upgrades
                for (const key of Object.keys(upgrades)) {
                    if (key === 'shovelPower' || key === 'luck' || key === 'oreValue') {
                        upgrades[key].level = 1;
                    } else {
                        upgrades[key].level = 0;
                    }
                }
                
                generateOres();
                updateDisplay();
                closeRebirth();
                
                let message = `üîÑ REBIRTH COMPLETE!\n\nYou now have ${rebirths} rebirth(s)!\nNew multiplier: ${Math.pow(1.5, rebirths).toFixed(1)}x`;
                
                alert(message);
            }
        }

        // Auto digger (spawns ores automatically)
        function startAutoDigger() {
            setInterval(() => {
                const skillBonuses = getSkillBonuses();
                const autoSpeedMult = skillBonuses.autoSpeedMult;
                let needsUpdate = false;
                
                if (upgrades.autoDig.level > 0 || autoSpeedMult > 1) {
                    const baseAutoLevel = Math.max(upgrades.autoDig.level, autoSpeedMult > 1 ? 1 : 0);
                    depth += baseAutoLevel * autoSpeedMult * skillBonuses.depthMult;
                    needsUpdate = true;
                    
                    if (Math.random() < 0.3) {
                        animateShovel();
                    }
                    
                    // Auto spawn ores based on auto-dig level + skill bonuses
                    const spawnChance = 0.12 + upgrades.autoDig.level * 0.05 + upgrades.oreSpawn.level * 0.02;
                    if (Math.random() < spawnChance && ores.length < 12 + skillBonuses.autoOres) {
                        spawnOre();
                    }
                    
                    // Skill: Auto ores bonus
                    const autoOresToSpawn = Math.min(skillBonuses.autoOres, 20); // Cap at 20 per second
                    for (let i = 0; i < autoOresToSpawn && ores.length < 30; i++) {
                        if (Math.random() < 0.5) spawnOre();
                    }
                    
                    // Guarantee minimum ores
                    if (ores.length < 2) {
                        spawnOre();
                    }
                }
                
                // Skill: Passive income
                if (skillBonuses.passiveIncome > 0) {
                    money += skillBonuses.passiveIncome * getTotalMultiplier();
                    needsUpdate = true;
                }
                
                // Skill: Interest rate
                if (skillBonuses.interestRate > 0 && money > 0) {
                    money += Math.floor(money * skillBonuses.interestRate);
                    needsUpdate = true;
                }
                
                // Skill: Auto collect ores
                if (skillBonuses.autoCollect && ores.length > 0) {
                    const oreToCollect = ores[0];
                    if (oreToCollect) {
                        const oreData = oreTypes.find(o => o.name === oreToCollect.dataset.name) || oreTypes[0];
                        mineOre(oreToCollect, oreData);
                    }
                }
                
                // Single update at the end
                if (needsUpdate) {
                    updateDisplay();
                }
            }, 1000);
            
            // Passive ore spawner - ensures ores always exist
            setInterval(() => {
                const minOres = 3 + getTotalWorkers(); // More workers need more ores
                if (ores.length < minOres) {
                    spawnOre();
                }
                // Spawn extra ores when workers are active
                if (getTotalWorkers() > 0 && ores.length < getTotalWorkers() * 2) {
                    spawnOre();
                }
                // Small chance to spawn even with some ores
                if (Math.random() < 0.1 && ores.length < 15 + getTotalWorkers()) {
                    spawnOre();
                }
            }, 2000);
        }

        // Modal functions
        function openShop() {
            document.getElementById('shop-modal').classList.add('active');
            renderUpgrades();
        }

        function closeShop() {
            document.getElementById('shop-modal').classList.remove('active');
        }

        function openRebirth() {
            document.getElementById('rebirth-modal').classList.add('active');
            updateDisplay();
        }

        function closeRebirth() {
            document.getElementById('rebirth-modal').classList.remove('active');
        }

        function openWorlds() {
            document.getElementById('worlds-modal').classList.add('active');
            renderWorlds();
        }

        function closeWorlds() {
            document.getElementById('worlds-modal').classList.remove('active');
        }

        // Admin Panel Functions
        function openAdmin() {
            document.getElementById('admin-modal').classList.add('active');
        }
        
        function closeAdmin() {
            document.getElementById('admin-modal').classList.remove('active');
        }
        
        // Settings Functions
        function openSettings() {
            document.getElementById('settings-modal').classList.add('active');
        }
        
        function closeSettings() {
            document.getElementById('settings-modal').classList.remove('active');
        }
        
        function resetAllProgress() {
            if (!confirm('‚ö†Ô∏è Are you sure you want to reset this save slot?\n\nThis will delete:\n- All money\n- All depth\n- All rebirths\n- All upgrades\n- All workers\n- All skill progress\n\nThis cannot be undone!')) return;
            
            if (!confirm('üõë FINAL WARNING: This action is PERMANENT.\n\nType OK to confirm you want to delete this save.')) return;
            
            // Clear current slot
            const lastSlot = localStorage.getItem('lastUsedSlot') || '1';
            localStorage.removeItem(`diggingGameSave_${lastSlot}`);
            
            // Reset all game state
            money = 0;
            depth = 0;
            rebirths = 0;
            currentWorld = 0;
            chosenPath = null;
            pathProgress = {};
            workers = [];
            workerCounts = { broke: 0, basic: 0, fast: 0, strong: 0, elite: 0, strongest: 0, sukuna: 0 };
            
            // Reset upgrades
            for (const key of Object.keys(upgrades)) {
                if (key === 'shovelPower' || key === 'luck' || key === 'oreValue') {
                    upgrades[key].level = 1;
                } else {
                    upgrades[key].level = 0;
                }
            }
            
            // Clear ores and regenerate
            ores.forEach(ore => ore.remove());
            ores = [];
            generateOres();
            
            // Update display
            updateWorldVisuals();
            updateDisplay();
            closeSettings();
            
            alert('‚úÖ This save slot has been reset!');
        }
        
        function checkAdminCode() {
            const menuInput = document.getElementById('menu-admin-code-input');
            const gameInput = document.getElementById('admin-code-input');
            const input = menuInput && menuInput.style.display !== 'none' ? menuInput : gameInput;
            
            if (input && input.value === '3843') {
                if(menuInput && menuInput === input) {
                    closeMenuSettings();
                } else {
                    closeSettings();
                }
                openAdmin();
                input.value = '';
            } else if (input) {
                input.style.borderColor = '#e74c3c';
                input.value = '';
                setTimeout(() => {
                    input.style.borderColor = '#444';
                }, 1000);
            }
        }
        
        function admin1000Rebirths() {
            rebirths += 1000;
            updateDisplay();
            alert('‚úÖ Added 1000 rebirths! Total: ' + rebirths);
        }
        
        function adminTrillionMoney() {
            money += 1000000000000;
            updateDisplay();
            alert('‚úÖ Added $1 Trillion!');
        }
        
        function toggleHakariMode() {
            adminHakariMode = !adminHakariMode;
            const btn = document.getElementById('hakari-toggle-btn');
            if (adminHakariMode) {
                btn.textContent = 'üé∞ 100% Hakari: ON';
                btn.classList.add('active');
            } else {
                btn.textContent = 'üé∞ 100% Hakari: OFF';
                btn.classList.remove('active');
            }
        }
        
        function adminSpawnHakari() {
            // Force spawn a Hakari worker
            const type = workerTypes.find(w => w.id === 'elite');
            const miningArea = document.getElementById('dirt-layer');
            const skin = skinTones[Math.floor(Math.random() * skinTones.length)];
            
            const workerEl = document.createElement('div');
            workerEl.className = 'worker hakari';
            workerEl.innerHTML = `
                <div class="worker-body">
                    <div class="worker-head" style="background: ${skin.skin}; border-color: ${skin.border}"></div>
                    <div class="worker-torso" style="background: ${type.color}"></div>
                    <div class="worker-arm left" style="background: ${skin.skin}"></div>
                    <div class="worker-arm right" style="background: ${skin.skin}"></div>
                    <div class="worker-leg left"></div>
                    <div class="worker-leg right"></div>
                    <div class="worker-pickaxe">üé∞</div>
                </div>
            `;
            
            const startX = Math.random() * 80 + 10;
            workerEl.style.left = startX + '%';
            workerEl.style.top = '80%';
            miningArea.appendChild(workerEl);
            
            const workerObj = {
                element: workerEl,
                type: type,
                x: startX,
                y: 80,
                targetOre: null,
                state: 'idle',
                miningTimer: 0,
                isHakari: true,
                domainCooldown: 0
            };
            
            workers.push(workerObj);
            workerCounts.elite++;
            
            // Announce and activate domain
            setTimeout(() => activateDomainExpansion(workerObj), 500);
            const popup = document.createElement('div');
            popup.className = 'domain-text';
            popup.style.left = startX + '%';
            popup.style.top = '70%';
            popup.textContent = 'üé∞ HAKARI HAS ARRIVED! üé∞';
            miningArea.appendChild(popup);
            setTimeout(() => popup.remove(), 3000);
            
            alert('‚úÖ Spawned Hakari!');
        }
        
        function adminMaxMoney() {
            money += 1e66;
            updateDisplay();
            alert('‚úÖ Added 1e66 money!');
        }
        
        function adminSpawnStrongest() {
            // Force spawn The Strongest worker
            const type = workerTypes.find(w => w.id === 'strongest');
            const miningArea = document.getElementById('dirt-layer');
            const skin = skinTones[Math.floor(Math.random() * skinTones.length)];
            
            const workerEl = document.createElement('div');
            workerEl.className = 'worker strongest';
            workerEl.innerHTML = `
                <div class="worker-body">
                    <div class="worker-head" style="background: ${skin.skin}; border-color: ${skin.border}"></div>
                    <div class="worker-torso" style="background: ${type.color}"></div>
                    <div class="worker-arm left" style="background: ${skin.skin}"></div>
                    <div class="worker-arm right" style="background: ${skin.skin}"></div>
                    <div class="worker-leg left"></div>
                    <div class="worker-leg right"></div>
                    <div class="worker-pickaxe">‚ôæÔ∏è</div>
                </div>
            `;
            
            const startX = Math.random() * 80 + 10;
            workerEl.style.left = startX + '%';
            workerEl.style.top = '80%';
            miningArea.appendChild(workerEl);
            
            const workerObj = {
                element: workerEl,
                type: type,
                x: startX,
                y: 80,
                targetOre: null,
                state: 'idle',
                miningTimer: 0,
                isStrongest: true,
                domainCooldown: 0,
                battleBuff: 0,
                clashBuff: 0
            };
            
            workers.push(workerObj);
            workerCounts.strongest++;
            
            setTimeout(() => activateInfiniteVoid(workerObj), 500);
            const popup = document.createElement('div');
            popup.className = 'domain-text';
            popup.style.left = startX + '%';
            popup.style.top = '70%';
            popup.style.color = '#00bfff';
            popup.textContent = '‚ôæÔ∏è THE STRONGEST HAS ARRIVED! ‚ôæÔ∏è';
            miningArea.appendChild(popup);
            setTimeout(() => popup.remove(), 3000);
            
            alert('‚úÖ Spawned The Strongest!');
        }
        
        function adminSpawnSukuna() {
            // Force spawn Sukuna (the 1 in 1 trillion variant)
            const type = workerTypes.find(w => w.id === 'strongest');
            const miningArea = document.getElementById('dirt-layer');
            const skin = skinTones[Math.floor(Math.random() * skinTones.length)];
            
            const workerEl = document.createElement('div');
            workerEl.className = 'worker sukuna';
            workerEl.innerHTML = `
                <div class="worker-body">
                    <div class="worker-head" style="background: ${skin.skin}; border-color: ${skin.border}"></div>
                    <div class="worker-torso" style="background: #8b0000"></div>
                    <div class="worker-arm left" style="background: ${skin.skin}"></div>
                    <div class="worker-arm right" style="background: ${skin.skin}"></div>
                    <div class="worker-leg left"></div>
                    <div class="worker-leg right"></div>
                    <div class="worker-pickaxe">üî•</div>
                </div>
            `;
            
            const startX = Math.random() * 80 + 10;
            workerEl.style.left = startX + '%';
            workerEl.style.top = '80%';
            miningArea.appendChild(workerEl);
            
            const workerObj = {
                element: workerEl,
                type: type,
                x: startX,
                y: 80,
                targetOre: null,
                state: 'idle',
                miningTimer: 0,
                isSukuna: true,
                domainCooldown: 0,
                battleBuff: 0,
                clashBuff: 0
            };
            
            workers.push(workerObj);
            workerCounts.strongest++;
            
            setTimeout(() => activateMalevolentShrine(workerObj), 500);
            const popup = document.createElement('div');
            popup.className = 'domain-text';
            popup.style.left = startX + '%';
            popup.style.top = '70%';
            popup.style.color = '#ff0000';
            popup.style.textShadow = '2px 2px 4px #8b0000, -2px -2px 4px #8b0000, 0 0 20px #ff0000';
            popup.style.fontSize = '20px';
            popup.textContent = 'üëπ RYOMEN SUKUNA - THE KING OF CURSES! üëπ';
            miningArea.appendChild(popup);
            setTimeout(() => popup.remove(), 5000);
            
            alert('‚úÖ Spawned Sukuna - The King of Curses!');
        }
        
        // Admin code listener (type 3843 anywhere)
        document.addEventListener('keydown', (e) => {
            adminCodeBuffer += e.key;
            if (adminCodeBuffer.length > 4) {
                adminCodeBuffer = adminCodeBuffer.slice(-4);
            }
            if (adminCodeBuffer === '3843') {
                openAdmin();
                adminCodeBuffer = '';
            }
        });

        // Skill Tree Functions
        function openSkillTree() {
            document.getElementById('skill-tree-modal').classList.add('active');
            renderSkillTree();
        }

        function closeSkillTree() {
            document.getElementById('skill-tree-modal').classList.remove('active');
        }

        function getCurrentTier(pathIdx) {
            if (!pathProgress[pathIdx]) return 0;
            return Object.keys(pathProgress[pathIdx]).length;
        }
        
        function getSkillTierCost(tier) {
            if (tier >= SKILL_TIER_COSTS.length) return Infinity;
            return SKILL_TIER_COSTS[tier];
        }

        function renderSkillTree() {
            document.getElementById('skill-money').textContent = formatNumber(money);
            
            const pathContainer = document.getElementById('path-selection');
            pathContainer.innerHTML = '';
            
            skillPaths.forEach((path, idx) => {
                const isChosen = chosenPath === idx;
                const isLocked = chosenPath !== null && chosenPath !== idx;
                const currentTier = getCurrentTier(idx);
                
                const card = document.createElement('div');
                card.className = 'path-card' + (isChosen ? ' active' : '') + (isLocked ? ' not-chosen' : '');
                card.style.borderColor = isChosen ? '#ffd700' : path.color;
                card.innerHTML = `
                    <div class="path-icon">${path.icon}</div>
                    <div class="path-name">${path.name}</div>
                    <div class="path-desc">${path.description}</div>
                    <div class="path-level">Tier: ${currentTier} / 5</div>
                `;
                
                if (!isLocked) {
                    card.onclick = () => selectPath(idx);
                }
                
                pathContainer.appendChild(card);
            });
            
            // Show upgrade choices if path is selected
            const choicesDiv = document.getElementById('upgrade-choices');
            const optionsDiv = document.getElementById('choice-options');
            const progressDiv = document.getElementById('skill-progress');
            
            if (chosenPath !== null) {
                const path = skillPaths[chosenPath];
                const currentTier = getCurrentTier(chosenPath);
                
                // Show progress dots
                progressDiv.innerHTML = '';
                for (let i = 0; i < 5; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'tier-dot';
                    if (i < currentTier) dot.classList.add('unlocked');
                    if (i === currentTier && currentTier < 5) dot.classList.add('current');
                    dot.textContent = i + 1;
                    progressDiv.appendChild(dot);
                }
                
                // Show choices for current tier
                optionsDiv.innerHTML = '';
                
                const tierCost = getSkillTierCost(currentTier);
                const canAfford = money >= tierCost;
                
                if (currentTier >= 5) {
                    optionsDiv.innerHTML = '<p style="color: #7bed9f; text-align: center;">üéâ Path Complete! You\'ve mastered this path!</p>';
                } else {
                    const tierChoices = path.tiers[currentTier];
                    optionsDiv.innerHTML = `<p style="color: ${canAfford ? '#7bed9f' : '#ff6b6b'}; text-align: center; margin-bottom: 15px;">Tier ${currentTier + 1} Cost: $${formatNumber(tierCost)} ${canAfford ? '‚úì' : '(Need more money)'}</p>`;
                    
                    tierChoices.forEach((choice, choiceIdx) => {
                        const card = document.createElement('div');
                        card.className = 'choice-card' + (canAfford ? '' : ' locked');
                        card.innerHTML = `
                            <div class="choice-icon">${choice.icon}</div>
                            <div class="choice-name">${choice.name}</div>
                            <div class="choice-effect">${choice.effect}</div>
                            <div class="choice-cost">$${formatNumber(tierCost)}</div>
                        `;
                        if (canAfford) {
                            card.onclick = () => purchaseSkill(chosenPath, currentTier, choiceIdx);
                        }
                        optionsDiv.appendChild(card);
                    });
                }
                
                choicesDiv.classList.add('visible');
            } else {
                choicesDiv.classList.remove('visible');
            }
        }

        function selectPath(pathIdx) {
            if (chosenPath !== null && chosenPath !== pathIdx) {
                return; // Can't change path once chosen
            }
            
            if (chosenPath === null) {
                const confirmed = confirm(`Are you sure you want to choose the ${skillPaths[pathIdx].name}?\n\nThis cannot be undone! You will only be able to upgrade this path.`);
                if (confirmed) {
                    chosenPath = pathIdx;
                    pathProgress[pathIdx] = {};
                }
            }
            renderSkillTree();
        }

        function purchaseSkill(pathIdx, tierIdx, choiceIdx) {
            const cost = getSkillTierCost(tierIdx);
            if (money < cost) return;
            if (pathProgress[pathIdx] && pathProgress[pathIdx][tierIdx] !== undefined) return;
            
            money -= cost;
            if (!pathProgress[pathIdx]) pathProgress[pathIdx] = {};
            pathProgress[pathIdx][tierIdx] = choiceIdx;
            
            // Apply the bonus
            applySkillBonus(pathIdx, tierIdx, choiceIdx);
            
            renderSkillTree();
            updateDisplay();
        }

        // Calculate total skill bonuses
        function getSkillBonuses() {
            const bonuses = {
                digPowerMult: 1,
                depthMult: 1,
                oreSpawnChance: 0,
                orePerDig: 0,
                oreValueMult: 1,
                luckMult: 1,
                rareChance: 0,
                moneyChances: [],
                autoSpeedMult: 1,
                autoOres: 0,
                passiveIncome: 0,
                interestRate: 0,
                autoCollect: false,
                onlyRare: false,
                minRarity: 0
            };
            
            for (const pathIdx in pathProgress) {
                const path = skillPaths[pathIdx];
                for (const tierIdx in pathProgress[pathIdx]) {
                    const choiceIdx = pathProgress[pathIdx][tierIdx];
                    const choice = path.tiers[tierIdx][choiceIdx];
                    const b = choice.bonus;
                    
                    switch(b.type) {
                        case 'digPower': bonuses.digPowerMult *= b.mult; break;
                        case 'depthMult': bonuses.depthMult *= b.mult; break;
                        case 'oreSpawnChance': bonuses.oreSpawnChance += b.add; break;
                        case 'orePerDig': bonuses.orePerDig += b.add; break;
                        case 'oreValue': bonuses.oreValueMult *= b.mult; break;
                        case 'luck': bonuses.luckMult *= b.mult; break;
                        case 'rareChance': bonuses.rareChance += b.add; break;
                        case 'moneyChance': bonuses.moneyChances.push({ chance: b.chance, mult: b.mult }); break;
                        case 'autoSpeed': bonuses.autoSpeedMult *= b.mult; break;
                        case 'autoOres': bonuses.autoOres += b.add; break;
                        case 'passiveIncome': bonuses.passiveIncome += b.add; break;
                        case 'interest': bonuses.interestRate += b.rate; break;
                        case 'autoCollect': bonuses.autoCollect = true; break;
                        case 'onlyRare': bonuses.onlyRare = true; bonuses.minRarity = Math.max(bonuses.minRarity, b.minRarity); break;
                        case 'godMode': 
                            bonuses.digPowerMult *= b.mult; 
                            bonuses.oreValueMult *= b.mult; 
                            bonuses.luckMult *= b.mult;
                            break;
                        case 'oreLord':
                            bonuses.oreValueMult *= b.mult;
                            bonuses.orePerDig += b.ores;
                            break;
                        case 'luckGod':
                            bonuses.luckMult *= b.luckMult;
                            bonuses.oreValueMult *= b.oreMult;
                            break;
                        case 'afkMaster':
                            bonuses.autoSpeedMult *= b.speedMult;
                            bonuses.autoOres += b.ores;
                            break;
                    }
                }
            }
            
            return bonuses;
        }

        function applySkillBonus(pathIdx, tierIdx, choiceIdx) {
            // Bonuses are applied dynamically via getSkillBonuses()
            // This function is for immediate effects or notifications
            const choice = skillPaths[pathIdx].tiers[tierIdx][choiceIdx];
            // Could add particle effects or notifications here
        }

        // Worker Functions
        function getWorkerCost(workerId) {
            const type = workerTypes.find(w => w.id === workerId);
            const count = workerCounts[workerId] || 0;
            return Math.floor(type.baseCost * Math.pow(type.costMult, count));
        }
        
        function getTotalWorkers() {
            return Object.values(workerCounts).reduce((a, b) => a + b, 0);
        }
        
        function hireWorker(workerId) {
            const WORKER_CAP = 100;
            const type = workerTypes.find(w => w.id === workerId);
            const cap = type.maxCount || WORKER_CAP;
            const cost = getWorkerCost(workerId);
            if (money >= cost && workerCounts[workerId] < cap) {
                money -= cost;
                workerCounts[workerId]++;
                spawnWorker(workerId);
                updateDisplay();
                renderWorkers();
            }
        }
        
        // Skin tone variations
        const skinTones = [
            { skin: '#ffdbac', border: '#d4a574' },  // Light
            { skin: '#f1c27d', border: '#c9a05c' },  // Fair
            { skin: '#e0ac69', border: '#b8894d' },  // Medium
            { skin: '#c68642', border: '#9e6a32' },  // Tan
            { skin: '#8d5524', border: '#6b3f1a' },  // Brown
            { skin: '#5c3317', border: '#3d200e' }   // Dark
        ];
        
        function spawnWorker(workerId) {
            const type = workerTypes.find(w => w.id === workerId);
            const miningArea = document.getElementById('dirt-layer');
            const skin = skinTones[Math.floor(Math.random() * skinTones.length)];
            
            // 1/1000 chance for elite workers to be Hakari (or 100% if admin mode)
            const isHakari = workerId === 'elite' && (adminHakariMode || Math.random() < 0.001);
            const isStrongest = workerId === 'strongest';
            const isSukuna = workerId === 'sukuna';
            
            let workerClass = 'worker';
            if (isHakari) workerClass += ' hakari';
            if (isSukuna) workerClass += ' sukuna';
            else if (isStrongest) workerClass += ' strongest';
            
            const workerEl = document.createElement('div');
            workerEl.className = workerClass;
            workerEl.innerHTML = `
                <div class="worker-body">
                    <div class="worker-head" style="background: ${isSukuna ? '#5c1a1a' : skin.skin}; border-color: ${isSukuna ? '#8b0000' : skin.border}"></div>
                    <div class="worker-torso" style="background: ${type.color}"></div>
                    <div class="worker-arm left" style="background: ${isSukuna ? '#5c1a1a' : skin.skin}"></div>
                    <div class="worker-arm right" style="background: ${isSukuna ? '#5c1a1a' : skin.skin}"></div>
                    <div class="worker-leg left"></div>
                    <div class="worker-leg right"></div>
                    <div class="worker-pickaxe">${isHakari ? 'üé∞' : (isSukuna ? 'üî•' : (isStrongest ? '‚ôæÔ∏è' : '‚õèÔ∏è'))}</div>
                </div>
            `;
            
            // Start at random position at bottom
            const startX = Math.random() * 80 + 10;
            workerEl.style.left = startX + '%';
            workerEl.style.top = '80%';
            
            miningArea.appendChild(workerEl);
            
            const workerObj = {
                element: workerEl,
                type: type,
                x: startX,
                y: 80,
                targetOre: null,
                state: 'idle',
                miningTimer: 0,
                isHakari: isHakari,
                isStrongest: isStrongest,
                isSukuna: isSukuna,
                domainCooldown: 0,
                battleBuff: 0,
                clashBuff: 0
            };
            
            workers.push(workerObj);
            
            // Note: Worker count is already incremented in hireWorker()
            
            // If Hakari spawned, announce it!
            if (isHakari) {
                setTimeout(() => activateDomainExpansion(workerObj), 500);
                const popup = document.createElement('div');
                popup.className = 'domain-text';
                popup.style.left = startX + '%';
                popup.style.top = '70%';
                popup.textContent = 'üé∞ HAKARI HAS ARRIVED! üé∞';
                miningArea.appendChild(popup);
                setTimeout(() => popup.remove(), 3000);
            }
            
            // If Sukuna spawned, announce it!
            if (isSukuna) {
                setTimeout(() => activateMalevolentShrine(workerObj), 500);
                const popup = document.createElement('div');
                popup.className = 'domain-text';
                popup.style.left = startX + '%';
                popup.style.top = '70%';
                popup.style.color = '#ff0000';
                popup.style.textShadow = '2px 2px 4px #8b0000, -2px -2px 4px #8b0000, 0 0 20px #ff0000';
                popup.style.fontSize = '20px';
                popup.textContent = 'üëπ RYOMEN SUKUNA - THE KING OF CURSES! üëπ';
                miningArea.appendChild(popup);
                setTimeout(() => popup.remove(), 5000);
            }
            // If The Strongest spawned, announce it!
            else if (isStrongest) {
                setTimeout(() => activateInfiniteVoid(workerObj), 500);
                const popup = document.createElement('div');
                popup.className = 'domain-text';
                popup.style.left = startX + '%';
                popup.style.top = '70%';
                popup.style.color = '#00bfff';
                popup.style.textShadow = '2px 2px 4px #1a1a2e, -2px -2px 4px #1a1a2e';
                popup.textContent = '‚ôæÔ∏è THE STRONGEST HAS ARRIVED! ‚ôæÔ∏è';
                miningArea.appendChild(popup);
                setTimeout(() => popup.remove(), 3000);
            }
        }
        
        function activateDomainExpansion(hakariWorker) {
            if (!hakariWorker.isHakari || hakariWorker.domainCooldown > 0) return;
            
            const miningArea = document.getElementById('dirt-layer');
            const domainRadius = 30; // percentage of screen
            
            // Visual casting effect (but Hakari can still move)
            hakariWorker.element.classList.add('casting');
            
            // Create domain visual
            const domain = document.createElement('div');
            domain.className = 'domain-expansion';
            domain.style.left = hakariWorker.x + '%';
            domain.style.top = hakariWorker.y + '%';
            domain.style.width = domainRadius * 2 + '%';
            domain.style.height = domainRadius * 2 + '%';
            miningArea.appendChild(domain);
            
            // Show domain text
            const text = document.createElement('div');
            text.className = 'domain-text';
            text.style.left = hakariWorker.x + '%';
            text.style.top = (hakariWorker.y - 10) + '%';
            text.textContent = 'üé∞ Domain Expansion: JACKPOT! üé∞';
            miningArea.appendChild(text);
            
            // Find ores in domain and triple their values
            let oresAffected = 0;
            let platinumCount = 0;
            const platinumData = { name: "Platinum", color: "#e5e4e2", value: 30000 };
            
            ores.forEach(ore => {
                const oreX = parseFloat(ore.style.left);
                const oreY = parseFloat(ore.style.top);
                const dist = Math.sqrt((oreX - hakariWorker.x) ** 2 + (oreY - hakariWorker.y) ** 2);
                
                if (dist <= domainRadius) {
                    oresAffected++;
                    // Triple the ore value
                    const currentValue = parseInt(ore.dataset.value);
                    ore.dataset.value = currentValue * 3;
                    ore.style.boxShadow = '0 0 15px gold, 0 0 25px #9b59b6';
                    
                    // Turn first 5 ores into Platinum
                    if (platinumCount < 5) {
                        ore.dataset.name = platinumData.name;
                        ore.dataset.value = platinumData.value * 3; // Tripled platinum!
                        ore.style.background = platinumData.color;
                        ore.textContent = 'Pt';
                        ore.style.color = '#000';
                        platinumCount++;
                    }
                }
            });
            
            // Set cooldown (Hakari can use domain again after 5 seconds)
            hakariWorker.domainCooldown = 300; // 5 seconds at 60fps
            
            // Clean up visuals
            setTimeout(() => {
                domain.remove();
                text.remove();
                hakariWorker.element.classList.remove('casting');
            }, 3000);
        }
        
        // Battle System - Epic Battle between Sukuna and The Strongest
        let epicBattle = {
            active: false,
            sukunaWorker: null,
            strongestWorker: null,
            domainClash: false,
            clashDuration: 0
        };
        
        function checkForEpicBattle() {
            // Find Sukuna and Strongest workers
            const sukunaWorker = workers.find(w => w.isSukuna);
            const strongestWorker = workers.find(w => w.isStrongest && !w.isSukuna);
            
            return { sukunaWorker, strongestWorker };
        }
        
        function startEpicBattle(sukunaWorker, strongestWorker) {
            const miningArea = document.getElementById('dirt-layer');
            
            epicBattle.active = true;
            epicBattle.sukunaWorker = sukunaWorker;
            epicBattle.strongestWorker = strongestWorker;
            
            // DRAMATIC CUTSCENE START
            // Create black vignette for dramatic effect
            const cutscene = document.createElement('div');
            cutscene.id = 'battle-cutscene';
            cutscene.style.cssText = `
                position: absolute;
                width: 100%;
                height: 100%;
                left: 0;
                top: 0;
                background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.9) 100%);
                z-index: 150;
                pointer-events: none;
                animation: cutsceneVignette 0.5s ease-in-out forwards;
            `;
            miningArea.appendChild(cutscene);
            
            // Flash white for impact
            const flashEffect = document.createElement('div');
            flashEffect.style.cssText = `
                position: absolute;
                width: 100%;
                height: 100%;
                left: 0;
                top: 0;
                background: white;
                z-index: 160;
                pointer-events: none;
                animation: battleFlash 0.4s ease-out forwards;
            `;
            miningArea.appendChild(flashEffect);
            
            // Move workers to center and face each other
            const centerX = 50;
            const centerY = 50;
            
            sukunaWorker.element.style.transition = 'all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)';
            sukunaWorker.x = centerX - 12;
            sukunaWorker.y = centerY;
            sukunaWorker.element.style.left = sukunaWorker.x + '%';
            sukunaWorker.element.style.top = sukunaWorker.y + '%';
            sukunaWorker.element.style.transform = 'scaleX(1)'; // Face right
            
            strongestWorker.element.style.transition = 'all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)';
            strongestWorker.x = centerX + 12;
            strongestWorker.y = centerY;
            strongestWorker.element.style.left = strongestWorker.x + '%';
            strongestWorker.element.style.top = strongestWorker.y + '%';
            strongestWorker.element.style.transform = 'scaleX(-1)'; // Face left
            
            // Create clash line effect with slashing animation
            setTimeout(() => {
                // Main vertical clash line
                const clashLine = document.createElement('div');
                clashLine.style.cssText = `
                    position: absolute;
                    width: 4px;
                    height: 80%;
                    left: 50%;
                    top: 10%;
                    background: linear-gradient(180deg, transparent, #ff00ff, transparent);
                    transform: translateX(-50%);
                    z-index: 155;
                    box-shadow: 0 0 20px #ff00ff, 0 0 40px #ff0000, 0 0 60px #00bfff;
                    animation: clashLineExpand 0.8s ease-out forwards;
                `;
                miningArea.appendChild(clashLine);
                
                // Diagonal slash 1 (left to right)
                const slash1 = document.createElement('div');
                slash1.style.cssText = `
                    position: absolute;
                    width: 120px;
                    height: 4px;
                    left: 40%;
                    top: 40%;
                    background: linear-gradient(90deg, transparent, #ff0000, transparent);
                    transform: rotate(35deg);
                    z-index: 156;
                    box-shadow: 0 0 15px #ff0000;
                    animation: slashAnim 0.5s ease-out forwards;
                `;
                miningArea.appendChild(slash1);
                
                // Diagonal slash 2 (right to left)
                const slash2 = document.createElement('div');
                slash2.style.cssText = `
                    position: absolute;
                    width: 120px;
                    height: 4px;
                    left: 50%;
                    top: 45%;
                    background: linear-gradient(90deg, transparent, #00bfff, transparent);
                    transform: rotate(-35deg);
                    z-index: 156;
                    box-shadow: 0 0 15px #00bfff;
                    animation: slashAnim 0.5s ease-out forwards 0.2s both;
                `;
                miningArea.appendChild(slash2);
                
                // Horizontal slash
                const slash3 = document.createElement('div');
                slash3.style.cssText = `
                    position: absolute;
                    width: 200px;
                    height: 3px;
                    left: 25%;
                    top: 50%;
                    background: linear-gradient(90deg, transparent, #ff00ff, #ff0000, transparent);
                    z-index: 157;
                    box-shadow: 0 0 20px #ff00ff, 0 0 30px #ff0000;
                    animation: horizSlash 0.6s ease-out forwards 0.1s both;
                `;
                miningArea.appendChild(slash3);
                
                setTimeout(() => {
                    clashLine.remove();
                    slash1.remove();
                    slash2.remove();
                    slash3.remove();
                }, 1200);
            }, 300);
            
            // Create battle animation background
            const battleBg = document.createElement('div');
            battleBg.id = 'epic-battle-bg';
            battleBg.style.cssText = `
                position: absolute;
                width: 100%;
                height: 100%;
                left: 0;
                top: 0;
                background: radial-gradient(circle at 50% 50%, rgba(255,0,0,0.2), transparent 30%),
                            radial-gradient(circle at 50% 50%, rgba(0,191,255,0.2), transparent 35%);
                animation: battlePulse 0.5s ease-in-out infinite;
                z-index: 50;
                pointer-events: none;
            `;
            miningArea.appendChild(battleBg);
            
            // Create battle title text
            const battleText = document.createElement('div');
            battleText.style.cssText = `
                position: absolute;
                left: 50%;
                top: 15%;
                transform: translateX(-50%);
                font-size: 36px;
                font-weight: bold;
                color: #ff00ff;
                text-shadow: 0 0 20px #ff00ff, 0 0 40px #ff0000, 0 0 60px #8b0000;
                z-index: 100;
                animation: battleTextDropIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
                opacity: 0;
            `;
            battleText.textContent = '‚ö° SUKUNA VS GOJO ‚ö°';
            miningArea.appendChild(battleText);
            
            // Add CSS keyframes if not already present
            if (!document.getElementById('battle-animations')) {
                const style = document.createElement('style');
                style.id = 'battle-animations';
                style.textContent = `
                    @keyframes cutsceneVignette {
                        0% { opacity: 0; }
                        100% { opacity: 1; }
                    }
                    @keyframes battleFlash {
                        0% { opacity: 1; }
                        100% { opacity: 0; }
                    }
                    @keyframes clashLineExpand {
                        0% { width: 4px; }
                        50% { width: 40%; }
                        100% { width: 4px; }
                    }
                    @keyframes slashAnim {
                        0% { opacity: 0; transform: scaleX(0) rotate(35deg); }
                        50% { opacity: 1; }
                        100% { opacity: 0; transform: scaleX(1) rotate(35deg); }
                    }
                    @keyframes horizSlash {
                        0% { opacity: 0; width: 0; left: 50%; }
                        50% { opacity: 1; }
                        100% { opacity: 0; width: 200px; left: 25%; }
                    }
                    @keyframes battleTextDropIn {
                        0% { opacity: 0; transform: translateX(-50%) translateY(-50px); }
                        100% { opacity: 1; transform: translateX(-50%) translateY(0); }
                    }
                    @keyframes battlePulse {
                        0%, 100% { opacity: 0.3; transform: scale(1); }
                        50% { opacity: 0.6; transform: scale(1.05); }
                    }
                    @keyframes battleTextPulse {
                        0%, 100% { transform: translateX(-50%) scale(1); }
                        50% { transform: translateX(-50%) scale(1.1); }
                    }
                    @keyframes domainClashEffect {
                        0%, 100% { opacity: 0.8; }
                        50% { opacity: 1; filter: brightness(1.5); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Buff all workers' stats during battle
            workers.forEach(w => {
                w.battleBuff = 1000000; // +1 million to stats
            });
            
            // Clean up cutscene after animations finish
            setTimeout(() => {
                cutscene.style.animation = 'cutsceneVignette 0.5s ease-in-out reverse forwards';
                if (flashEffect && document.contains(flashEffect)) {
                    flashEffect.remove();
                }
            }, 2500);
            
            // Clean up battle in 10 seconds
            setTimeout(() => {
                if (cutscene && document.contains(cutscene)) cutscene.remove();
                endEpicBattle(miningArea, battleBg, battleText);
            }, 10000);
        }
        
        function endEpicBattle(miningArea, battleBg, battleText) {
            epicBattle.active = false;
            epicBattle.sukunaWorker = null;
            epicBattle.strongestWorker = null;
            
            // Remove battle visuals
            if (battleBg && document.contains(battleBg)) battleBg.remove();
            if (battleText && document.contains(battleText)) battleText.remove();
            
            // Remove stat buff
            workers.forEach(w => {
                w.battleBuff = 0;
            });
        }
        
        function handleDomainClash(sukunaWorker, strongestWorker) {
            const miningArea = document.getElementById('dirt-layer');
            
            epicBattle.domainClash = true;
            epicBattle.clashDuration = 300; // 5 seconds at 60fps
            
            // Create clash visual at midpoint - much more subtle
            const clashX = (sukunaWorker.x + strongestWorker.x) / 2;
            const clashY = (sukunaWorker.y + strongestWorker.y) / 2;
            
            const clashEffect = document.createElement('div');
            clashEffect.id = 'domain-clash';
            clashEffect.style.cssText = `
                position: absolute;
                left: ${clashX}%;
                top: ${clashY}%;
                width: 150px;
                height: 150px;
                margin-left: -75px;
                margin-top: -75px;
                background: radial-gradient(circle, rgba(255,100,255,0.3) 0%, rgba(0,191,255,0.2) 50%, transparent 100%);
                border: 2px solid #ff00ff;
                border-radius: 50%;
                animation: domainClashEffect 0.3s ease-in-out infinite;
                z-index: 60;
                pointer-events: none;
                box-shadow: 0 0 30px #ff00ff, 0 0 50px #00bfff;
            `;
            miningArea.appendChild(clashEffect);
            
            // Create clash text
            const clashText = document.createElement('div');
            clashText.style.cssText = `
                position: absolute;
                left: 50%;
                top: 25%;
                transform: translateX(-50%);
                font-size: 28px;
                font-weight: bold;
                color: #ff00ff;
                text-shadow: 0 0 20px #ff00ff, 0 0 40px #ff0000, 0 0 60px #00bfff;
                z-index: 100;
                animation: battleTextPulse 0.5s ease-in-out infinite;
            `;
            clashText.textContent = 'üí• DOMAIN CLASH! üí•';
            miningArea.appendChild(clashText);
            
            // Buff all workers' stats 2x during clash
            workers.forEach(w => {
                w.clashBuff = 2000000; // +2 million to stats (double the normal battle buff)
            });
            
            // Clean up clash
            setTimeout(() => {
                epicBattle.domainClash = false;
                epicBattle.clashDuration = 0;
                if (clashEffect && document.contains(clashEffect)) clashEffect.remove();
                if (clashText && document.contains(clashText)) clashText.remove();
                
                // Remove clash buff
                workers.forEach(w => {
                    w.clashBuff = 0;
                });
            }, 5000);
        }
        
        // The Strongest's Domain Expansion: Infinite Void
        function activateInfiniteVoid(strongestWorker) {
            if (!strongestWorker.isStrongest || strongestWorker.domainCooldown > 0) return;
            
            // Check if Sukuna is also casting (domain clash)
            const sukunaWorker = workers.find(w => w.isSukuna);
            if (sukunaWorker && sukunaWorker.state === 'casting' && sukunaWorker.isSukuna) {
                // Domain clash detected!
                handleDomainClash(sukunaWorker, strongestWorker);
                strongestWorker.domainCooldown = 480;
                sukunaWorker.domainCooldown = 1200;
                return;
            }
            
            const miningArea = document.getElementById('dirt-layer');
            const domainRadius = 40; // percentage of screen - larger than Hakari's
            
            // Visual casting effect
            strongestWorker.element.classList.add('casting');
            
            // Create domain visual
            const domain = document.createElement('div');
            domain.className = 'domain-infinite-void';
            domain.style.left = strongestWorker.x + '%';
            domain.style.top = strongestWorker.y + '%';
            domain.style.width = domainRadius * 2 + '%';
            domain.style.height = domainRadius * 2 + '%';
            miningArea.appendChild(domain);
            
            // Show domain text
            const text = document.createElement('div');
            text.className = 'domain-text';
            text.style.left = strongestWorker.x + '%';
            text.style.top = (strongestWorker.y - 10) + '%';
            text.textContent = '‚ôæÔ∏è Domain Expansion: INFINITE VOID ‚ôæÔ∏è';
            text.style.color = '#00bfff';
            text.style.textShadow = '2px 2px 4px #1a1a2e, -2px -2px 4px #1a1a2e';
            miningArea.appendChild(text);
            
            // Get high-tier ores from other worlds
            const otherWorldOres = oreTypes.filter(ore => ore.worldMin > 0 && ore.worldMin <= 7);
            
            // Find ores in domain and transform them to ores from other worlds
            ores.forEach(ore => {
                const oreX = parseFloat(ore.style.left);
                const oreY = parseFloat(ore.style.top);
                const dist = Math.sqrt((oreX - strongestWorker.x) ** 2 + (oreY - strongestWorker.y) ** 2);
                
                if (dist <= domainRadius && otherWorldOres.length > 0) {
                    // Pick a random ore from other worlds
                    const randomOre = otherWorldOres[Math.floor(Math.random() * otherWorldOres.length)];
                    
                    // Transform the ore
                    ore.dataset.name = randomOre.name;
                    ore.dataset.value = randomOre.value * 5; // 5x value!
                    ore.style.background = randomOre.color;
                    ore.textContent = randomOre.name.substring(0, 2);
                    ore.style.color = randomOre.value > 1000 ? '#000' : '#fff';
                    ore.style.boxShadow = '0 0 20px #00bfff, 0 0 30px #1a1a2e';
                    
                    // Add void effect
                    ore.style.animation = 'infiniteVoidGlow 0.5s ease-in-out infinite alternate';
                }
            });
            
            // Set cooldown (8 seconds - longer due to power)
            strongestWorker.domainCooldown = 480; // 8 seconds at 60fps
            
            // Clean up visuals
            setTimeout(() => {
                domain.remove();
                text.remove();
                strongestWorker.element.classList.remove('casting');
                // Remove void effect from ores
                ores.forEach(ore => {
                    ore.style.animation = '';
                });
            }, 4000);
        }
        
        // Sukuna's Domain Expansion: Malevolent Shrine
        function activateMalevolentShrine(sukunaWorker) {
            if (!sukunaWorker.isSukuna || sukunaWorker.domainCooldown > 0) return;
            
            // Check if Strongest is also casting (domain clash)
            const strongestWorker = workers.find(w => w.isStrongest && !w.isSukuna);
            if (strongestWorker && strongestWorker.state === 'casting' && strongestWorker.isStrongest) {
                // Domain clash detected!
                handleDomainClash(sukunaWorker, strongestWorker);
                sukunaWorker.domainCooldown = 1200;
                strongestWorker.domainCooldown = 480;
                return;
            }
            
            const miningArea = document.getElementById('dirt-layer');
            
            // Visual casting effect
            sukunaWorker.element.classList.add('casting');
            
            // Create domain visual - covers ENTIRE screen
            const domain = document.createElement('div');
            domain.className = 'domain-malevolent-shrine';
            miningArea.appendChild(domain);
            
            // Show domain text
            const text = document.createElement('div');
            text.className = 'domain-text';
            text.style.left = '50%';
            text.style.top = '30%';
            text.style.fontSize = '24px';
            text.style.color = '#ff0000';
            text.style.textShadow = '3px 3px 6px #8b0000, -3px -3px 6px #8b0000, 0 0 30px #ff0000';
            text.textContent = 'üëπ Domain Expansion: MALEVOLENT SHRINE üëπ';
            miningArea.appendChild(text);
            
            // Collect ALL ores on the map and increase value by 300 trillion
            const VALUE_BOOST = 300000000000000; // 300 trillion
            let totalCollected = 0;
            let totalValue = 0;
            
            // Clone ores array since we'll be modifying it
            const oresToCollect = [...ores];
            
            oresToCollect.forEach((ore, index) => {
                setTimeout(() => {
                    if (document.contains(ore)) {
                        // Calculate boosted value
                        const baseValue = parseInt(ore.dataset.value) || 0;
                        const boostedValue = baseValue + VALUE_BOOST;
                        totalValue += boostedValue;
                        totalCollected++;
                        
                        // Visual effect - ore gets slashed
                        ore.style.boxShadow = '0 0 30px #ff0000, 0 0 50px #8b0000';
                        ore.style.transform = 'scale(1.5)';
                        ore.style.transition = 'all 0.2s';
                        
                        setTimeout(() => {
                            // Remove ore (don't add money - domain is visual only)
                            const oreIndex = ores.indexOf(ore);
                            if (oreIndex > -1) ores.splice(oreIndex, 1);
                            ore.remove();
                            
                            updateDisplay();
                        }, 200);
                    }
                }, index * 100); // Stagger collection for dramatic effect
            });
            
            // Set cooldown (20 seconds - most powerful)
            sukunaWorker.domainCooldown = 1200; // 20 seconds at 60fps
            
            // Clean up visuals
            setTimeout(() => {
                domain.remove();
                text.remove();
                sukunaWorker.element.classList.remove('casting');
                
                // Show collection summary
                const summary = document.createElement('div');
                summary.className = 'domain-text';
                summary.style.left = '50%';
                summary.style.top = '50%';
                summary.style.fontSize = '18px';
                summary.style.color = '#ff4500';
                summary.textContent = `üî• Collected ${totalCollected} ores! üî•`;
                miningArea.appendChild(summary);
                setTimeout(() => summary.remove(), 2000);
                
                // Spawn replacement ores so workers have targets
                for (let i = 0; i < 8; i++) {
                    setTimeout(() => spawnOre(), i * 100);
                }
            }, 4000);
        }
        
        function updateWorkers() {
            const miningArea = document.getElementById('dirt-layer');
            if (!miningArea) return;
            
            // Check for epic battle condition (Sukuna and Strongest both present)
            const { sukunaWorker, strongestWorker: strongestWorkerCheck } = checkForEpicBattle();
            if (sukunaWorker && strongestWorkerCheck && !epicBattle.active) {
                // Check if they're relatively close (within 50% distance on screen)
                const distance = Math.sqrt((sukunaWorker.x - strongestWorkerCheck.x) ** 2 + (sukunaWorker.y - strongestWorkerCheck.y) ** 2);
                if (distance < 50) {
                    // They're engaging! Start epic battle
                    startEpicBattle(sukunaWorker, strongestWorkerCheck);
                }
            }
            
            workers.forEach(worker => {
                // Hakari domain cooldown and periodic activation
                if (worker.isHakari) {
                    if (worker.domainCooldown > 0) {
                        worker.domainCooldown--;
                    } else if (worker.state !== 'casting') {
                        activateDomainExpansion(worker);
                    }
                }
                
                // The Strongest domain cooldown and periodic activation
                if (worker.isStrongest) {
                    if (worker.domainCooldown > 0) {
                        worker.domainCooldown--;
                    } else if (worker.state !== 'casting') {
                        activateInfiniteVoid(worker);
                    }
                }
                
                // Sukuna domain cooldown and periodic activation
                if (worker.isSukuna) {
                    if (worker.domainCooldown > 0) {
                        worker.domainCooldown--;
                    } else if (worker.state !== 'casting') {
                        activateMalevolentShrine(worker);
                    }
                }
                
                // Skip movement updates if casting (except special workers who can move during domain)
                if (worker.state === 'casting' && !worker.isHakari && !worker.isStrongest && !worker.isSukuna) return;
                
                if (worker.state === 'idle' || worker.state === 'walking') {
                    // Find target ore - Special workers target best ore, others target nearest
                    if (!worker.targetOre || !document.contains(worker.targetOre)) {
                        if (worker.isHakari || worker.isStrongest || worker.isSukuna) {
                            worker.targetOre = findBestOre();
                        } else {
                            worker.targetOre = findNearestOre(worker.x, worker.y);
                        }
                        worker.state = worker.targetOre ? 'walking' : 'idle';
                    }
                    
                    if (worker.targetOre && document.contains(worker.targetOre)) {
                        // Calculate ore position
                        const oreLeft = parseFloat(worker.targetOre.style.left);
                        const oreTop = parseFloat(worker.targetOre.style.top);
                        
                        // Special workers teleport instantly, others walk
                        if (worker.isHakari || worker.isStrongest || worker.isSukuna) {
                            // Teleport to ore
                            worker.x = oreLeft;
                            worker.y = oreTop;
                            worker.element.style.left = worker.x + '%';
                            worker.element.style.top = worker.y + '%';
                            
                            // Start mining immediately
                            worker.element.classList.remove('walking');
                            worker.element.classList.add('mining');
                            worker.state = 'mining';
                            worker.miningTimer = worker.isSukuna ? 5 : (worker.isStrongest ? 10 : 15); // Sukuna mines fastest
                            
                            // Teleport visual effect
                            const flashColor = worker.isSukuna ? 'rgba(255,0,0,0.8)' : (worker.isStrongest ? 'rgba(0,191,255,0.8)' : 'rgba(155,89,182,0.8)');
                            const flash = document.createElement('div');
                            flash.style.cssText = `position:absolute;left:${oreLeft}%;top:${oreTop}%;width:40px;height:40px;background:radial-gradient(circle,${flashColor},transparent);border-radius:50%;transform:translate(-50%,-50%);pointer-events:none;animation:teleportFlash 0.3s ease-out forwards;z-index:100;`;
                            document.getElementById('dirt-layer').appendChild(flash);
                            setTimeout(() => flash.remove(), 300);
                        } else {
                            // Normal walking behavior
                            const dx = oreLeft - worker.x;
                            const dy = oreTop - worker.y;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                        
                        if (dist > 3) {
                            // Walking
                            const speed = worker.type.speed / 60; // pixels per frame at 60fps
                            worker.x += (dx / dist) * speed * 0.5;
                            worker.y += (dy / dist) * speed * 0.5;
                            worker.element.style.left = worker.x + '%';
                            worker.element.style.top = worker.y + '%';
                            worker.element.classList.add('walking');
                            worker.element.classList.remove('mining');
                            worker.state = 'walking';
                            
                            // Flip worker based on direction
                            if (dx < 0) {
                                worker.element.style.transform = 'scaleX(-1)';
                            } else {
                                worker.element.style.transform = 'scaleX(1)';
                            }
                        } else {
                            // Reached ore, start mining
                            worker.element.classList.remove('walking');
                            worker.element.classList.add('mining');
                            worker.state = 'mining';
                            worker.miningTimer = 30; // frames to mine
                        }
                        } // End of normal worker else block
                    } else {
                        worker.element.classList.remove('walking');
                        worker.element.classList.remove('mining');
                        worker.state = 'idle';
                    }
                } else if (worker.state === 'mining') {
                    worker.miningTimer--;
                    if (worker.miningTimer <= 0) {
                        // Collect the ore (this rewards all workers on the ore)
                        if (worker.targetOre && document.contains(worker.targetOre)) {
                            collectOreByWorker(worker.targetOre, worker.type.collectMult);
                        } else {
                            // Ore was already collected by another worker
                            worker.targetOre = null;
                            worker.state = 'idle';
                            worker.element.classList.remove('mining');
                        }
                    }
                }
            });
        }
        
        function findNearestOre(x, y) {
            let nearestOre = null;
            let nearestDist = Infinity;
            
            // Count how many workers are targeting each ore (max 2 per ore)
            const oreWorkerCounts = new Map();
            workers.forEach(w => {
                if (w.targetOre) {
                    oreWorkerCounts.set(w.targetOre, (oreWorkerCounts.get(w.targetOre) || 0) + 1);
                }
            });
            
            ores.forEach(ore => {
                if (!document.contains(ore)) return;
                
                // Skip ores with 2 or more workers already
                const workerCount = oreWorkerCounts.get(ore) || 0;
                if (workerCount >= 2) return;
                
                const oreX = parseFloat(ore.style.left);
                const oreY = parseFloat(ore.style.top);
                const dist = Math.sqrt((oreX - x) ** 2 + (oreY - y) ** 2);
                
                if (dist < nearestDist) {
                    nearestDist = dist;
                    nearestOre = ore;
                }
            });
            
            return nearestOre;
        }
        
        function findBestOre() {
            let bestOre = null;
            let bestValue = -1;
            
            ores.forEach(ore => {
                if (!document.contains(ore)) return;
                
                const value = parseInt(ore.dataset.value) || 0;
                if (value > bestValue) {
                    bestValue = value;
                    bestOre = ore;
                }
            });
            
            return bestOre;
        }
        
        function collectOreByWorker(oreElement, collectMult) {
            if (!oreElement || !document.contains(oreElement)) return;
            
            const oreData = oreTypes.find(o => o.name === oreElement.dataset.name) || oreTypes[0];
            const baseValue = parseInt(oreElement.dataset.value);
            const totalMult = getTotalMultiplier();
            
            // Find all workers mining this ore and reward them all
            const workersOnOre = workers.filter(w => w.targetOre === oreElement);
            let totalEarned = 0;
            
            workersOnOre.forEach(w => {
                let earnedMoney = Math.floor(baseValue * totalMult * w.type.collectMult);
                
                // Apply battle/clash stat buffs
                if (w.clashBuff && w.clashBuff > 0) {
                    // Domain clash buff: 2x stats
                    earnedMoney += w.clashBuff * 2;
                } else if (w.battleBuff && w.battleBuff > 0) {
                    // Epic battle buff: +1 million per ore
                    earnedMoney += w.battleBuff;
                }
                
                money += earnedMoney;
                totalEarned += earnedMoney;
                
                // Reset the worker state
                w.targetOre = null;
                w.state = 'idle';
                w.element.classList.remove('mining');
            });
            
            // Show popup with total earned
            const popup = document.createElement('div');
            popup.className = 'money-popup';
            popup.textContent = '+$' + formatNumber(totalEarned);
            popup.style.left = oreElement.style.left;
            popup.style.top = oreElement.style.top;
            document.getElementById('dirt-layer').appendChild(popup);
            setTimeout(() => popup.remove(), 1000);
            
            // Remove ore
            oreElement.remove();
            ores = ores.filter(o => o !== oreElement);
            
            // Spawn new ores - more when workers are present
            const minOres = 5 + Math.floor(getTotalWorkers() / 2);
            if (ores.length < minOres) {
                spawnOre();
                if (ores.length < minOres - 2) spawnOre(); // Spawn extra if very low
            }
            
            updateDisplay();
        }
        
        function startWorkerLoop() {
            setInterval(updateWorkers, 1000 / 60); // 60 FPS for smooth animation
        }
        
        function openWorkers() {
            document.getElementById('workers-modal').classList.add('active');
            renderWorkers();
        }
        
        function closeWorkers() {
            document.getElementById('workers-modal').classList.remove('active');
        }
        
        function renderWorkers() {
            const container = document.getElementById('workers-container');
            if (!container) return;
            
            const WORKER_CAP = 100; // Max per type
            
            // Only rebuild if not yet created
            if (container.children.length === 0) {
                workerTypes.forEach(type => {
                    const cost = getWorkerCost(type.id);
                    const count = workerCounts[type.id];
                    const cap = type.maxCount || WORKER_CAP;
                    const atCap = count >= cap;
                    const canAfford = money >= cost && !atCap;
                    
                    const item = document.createElement('div');
                    item.className = 'upgrade-item';
                    item.dataset.workerId = type.id;
                    item.innerHTML = `
                        <div class="upgrade-info">
                            <h3>${type.icon} ${type.name}</h3>
                            <p>Speed: ${type.speed} | Collect: ${type.collectMult}x</p>
                            <p class="level">Owned: <span class="count-value">${count}</span>/<span class="cap-value">${cap}</span></p>
                        </div>
                        <button class="buy-btn" onclick="hireWorker('${type.id}')" ${canAfford ? '' : 'disabled'}>
                            ${atCap ? 'MAX' : '$' + formatNumber(cost)}
                        </button>
                    `;
                    container.appendChild(item);
                });
            } else {
                // Just update values without rebuilding
                workerTypes.forEach(type => {
                    const item = container.querySelector(`[data-worker-id="${type.id}"]`);
                    if (!item) return;
                    
                    const cost = getWorkerCost(type.id);
                    const count = workerCounts[type.id];
                    const cap = type.maxCount || WORKER_CAP;
                    const atCap = count >= cap;
                    const canAfford = money >= cost && !atCap;
                    const btnText = atCap ? 'MAX' : '$' + formatNumber(cost);
                    
                    const countSpan = item.querySelector('.count-value');
                    if (countSpan && countSpan.textContent !== String(count)) {
                        countSpan.textContent = count;
                    }
                    
                    const btn = item.querySelector('.buy-btn');
                    if (btn) {
                        if (btn.textContent !== btnText) {
                            btn.textContent = btnText;
                        }
                        if (btn.disabled === canAfford) {
                            btn.disabled = !canAfford;
                        }
                    }
                });
            }
            
            document.getElementById('worker-count').textContent = getTotalWorkers();
        }

        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('active');
                }
            });
        });

        // Save Game Function
        function saveGame(slotNumber = -1) {
            const saveData = {
                money: money,
                depth: depth,
                rebirths: rebirths,
                currentWorld: currentWorld,
                chosenPath: chosenPath,
                pathProgress: pathProgress,
                workerCounts: workerCounts,
                upgrades: {},
                timestamp: new Date().toISOString()
            };
            
            // Save upgrade levels
            for (const [key, upgrade] of Object.entries(upgrades)) {
                saveData.upgrades[key] = upgrade.level;
            }
            
            try {
                if (slotNumber === -1) {
                    // Save to last used slot (default behavior)
                    const lastSlot = localStorage.getItem('lastUsedSlot') || '1';
                    localStorage.setItem(`diggingGameSave_${lastSlot}`, JSON.stringify(saveData));
                    localStorage.setItem('lastUsedSlot', lastSlot);
                } else {
                    localStorage.setItem(`diggingGameSave_${slotNumber}`, JSON.stringify(saveData));
                    localStorage.setItem('lastUsedSlot', slotNumber);
                }
                alert('‚úÖ Game saved successfully!');
            } catch (e) {
                alert('‚ùå Failed to save game: ' + e.message);
            }
        }

        // UI Save button handler
        function saveGameUI() {
            const lastSlot = localStorage.getItem('lastUsedSlot') || '1';
            saveGame(parseInt(lastSlot));
        }
        
        // Load Game Function
        function loadGame(slotNumber = -1) {
            try {
                let slotToLoad = slotNumber;
                if (slotNumber === -1) {
                    slotToLoad = localStorage.getItem('lastUsedSlot') || '1';
                }

                const savedData = localStorage.getItem(`diggingGameSave_${slotToLoad}`);
                if (!savedData) {
                    alert('‚ùå No save data found!');
                    return;
                }
                
                const saveData = JSON.parse(savedData);
                
                // Restore game state
                money = saveData.money || 0;
                depth = saveData.depth || 0;
                rebirths = saveData.rebirths || 0;
                currentWorld = saveData.currentWorld || 0;
                chosenPath = saveData.chosenPath;
                pathProgress = saveData.pathProgress || {};
                workerCounts = saveData.workerCounts || { broke: 0, basic: 0, fast: 0, strong: 0, elite: 0, strongest: 0, sukuna: 0 };
                
                // Restore upgrade levels
                if (saveData.upgrades) {
                    for (const [key, level] of Object.entries(saveData.upgrades)) {
                        if (upgrades[key]) {
                            upgrades[key].level = level;
                        }
                    }
                }
                
                // Clear existing workers and respawn them
                workers.forEach(w => {
                    if (w.element && w.element.parentNode) {
                        w.element.remove();
                    }
                });
                workers = [];
                
                // Respawn workers based on counts
                for (const [workerId, count] of Object.entries(workerCounts)) {
                    for (let i = 0; i < count; i++) {
                        spawnWorker(workerId);
                    }
                }
                
                // Update visuals
                updateWorldVisuals();
                renderOreLegend();
                generateOres();
                updateDisplay();
                
                localStorage.setItem('lastUsedSlot', slotToLoad);
                alert('‚úÖ Game loaded successfully!');
            } catch (e) {
                alert('‚ùå Failed to load game: ' + e.message);
            }
        }

        // Get slot info for display
        function getSlotInfo(slotNumber) {
            try {
                const savedData = localStorage.getItem(`diggingGameSave_${slotNumber}`);
                if (!savedData) return null;
                
                const saveData = JSON.parse(savedData);
                return {
                    money: saveData.money || 0,
                    depth: saveData.depth || 0,
                    rebirths: saveData.rebirths || 0,
                    world: saveData.currentWorld || 0,
                    timestamp: saveData.timestamp || 'Unknown'
                };
            } catch (e) {
                return null;
            }
        }

        // Format large numbers for display
        function formatNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return Math.floor(num).toString();
        }

        // Show save slots UI
        function showSaveSlots(mode) {
            const slotsSection = document.getElementById('slots-section');
            const slotsTitle = document.getElementById('slots-title');
            const slotsContainer = document.getElementById('slots-container');

            slotsTitle.textContent = mode === 'new' ? 'üÜï Create New Game' : 'üìÇ Load Game';
            slotsContainer.innerHTML = '';

            for (let i = 1; i <= 3; i++) {
                const slotInfo = getSlotInfo(i);
                const slotDiv = document.createElement('div');
                slotDiv.className = slotInfo ? 'save-slot' : 'save-slot empty';
                
                if (slotInfo) {
                    const worldName = worlds[slotInfo.world]?.name || 'Unknown';
                    const date = new Date(slotInfo.timestamp).toLocaleDateString();
                    slotDiv.innerHTML = `
                        <div class="slot-number">Slot ${i}</div>
                        <div class="slot-info">üí∞ $${formatNumber(slotInfo.money)}</div>
                        <div class="slot-info">üîÑ Rebirths: ${slotInfo.rebirths}</div>
                        <div class="slot-info stat">üåç ${worldName} | ‚õèÔ∏è ${slotInfo.depth}m</div>
                        <div class="slot-info stat">${date}</div>
                        <div class="slot-buttons">
                            ${mode === 'load' ? `<button class="slot-btn load" onclick="loadFromSlotAndStart(${i})">Load</button>` : `<button class="slot-btn load" style="background: #e74c3c;" onclick="startNewGameInSlot(${i})">Overwrite</button>`}
                            <button class="slot-btn delete" onclick="deleteSlot(${i})">Delete</button>
                        </div>
                    `;
                } else {
                    slotDiv.innerHTML = mode === 'new' ? 'üÜï Create New Game' : 'üìÇ Empty Slot';
                    if (mode === 'new') {
                        slotDiv.onclick = () => startNewGameInSlot(i);
                        slotDiv.style.cursor = 'pointer';
                    } else {
                        slotDiv.style.cursor = 'not-allowed';
                    }
                }
                
                slotsContainer.appendChild(slotDiv);
            }

            slotsSection.style.display = 'block';
        }

        // Start new game in slot
        function startNewGameInSlot(slotNumber) {
            // Initialize fresh game state
            money = 0;
            depth = 0;
            rebirths = 0;
            currentWorld = 0;
            chosenPath = null;
            pathProgress = {};
            workerCounts = { broke: 0, basic: 0, fast: 0, strong: 0, elite: 0, strongest: 0, sukuna: 0 };

            // Reset upgrades (keep base levels for shovelPower and oreValue)
            for (const [key, upgrade] of Object.entries(upgrades)) {
                upgrade.level = (key === 'shovelPower' || key === 'oreValue') ? 1 : 0;
            }

            // Clear workers
            workers.forEach(w => {
                if (w.element && w.element.parentNode) {
                    w.element.remove();
                }
            });
            workers = [];

            // Save to slot
            const saveData = {
                money: 0,
                depth: 0,
                rebirths: 0,
                currentWorld: 0,
                chosenPath: null,
                pathProgress: {},
                workerCounts: { broke: 0, basic: 0, fast: 0, strong: 0, elite: 0, strongest: 0, sukuna: 0 },
                upgrades: {},
                timestamp: new Date().toISOString()
            };

            for (const [key, upgrade] of Object.entries(upgrades)) {
                saveData.upgrades[key] = (key === 'shovelPower' || key === 'oreValue') ? 1 : 0;
            }

            try {
                localStorage.setItem(`diggingGameSave_${slotNumber}`, JSON.stringify(saveData));
                localStorage.setItem('lastUsedSlot', slotNumber);
            } catch (e) {
                alert('Failed to create save: ' + e.message);
                return;
            }

            // Start game
            hideMainMenu();
            generateOres();
            renderUpgrades();
            renderOreLegend();
            startAutoDigger();
            startWorkerLoop();
            updateWorldVisuals();
            updateDisplay();
            loadSkinsData();
            initShovelTracking();
        }

        // Load from slot and start the game
        function loadFromSlotAndStart(slotNumber) {
            loadGame(slotNumber);
            hideMainMenu();
            generateOres();
            renderUpgrades();
            renderOreLegend();
            startAutoDigger();
            startWorkerLoop();
            updateWorldVisuals();
            updateDisplay();
            loadSkinsData();
            initShovelTracking();
        }

        // Delete a save slot
        function deleteSlot(slotNumber) {
            if (confirm(`Are you sure you want to delete Slot ${slotNumber}? This cannot be undone!`)) {
                try {
                    localStorage.removeItem(`diggingGameSave_${slotNumber}`);
                    const lastSlot = localStorage.getItem('lastUsedSlot');
                    if (lastSlot == slotNumber) {
                        localStorage.removeItem('lastUsedSlot');
                    }
                    showSaveSlots(document.getElementById('slots-title').textContent.includes('Load') ? 'load' : 'new');
                } catch (e) {
                    alert('Failed to delete save: ' + e.message);
                }
            }
        }

        // Menu navigation
        // Skip lore and show main menu
        function skipLore() {
            const loreScreen = document.getElementById('lore-screen');
            loreScreen.classList.remove('active');
            document.getElementById('main-menu').classList.add('active');
        }

        function showMainMenu() {
            document.getElementById('lore-screen').classList.remove('active');
            document.getElementById('main-menu').classList.add('active');
            document.getElementById('game-container').classList.add('hidden');
            document.getElementById('slots-section').style.display = 'none';
            document.getElementById('crates-section').classList.remove('active');
        }

        function hideMainMenu() {
            document.getElementById('main-menu').classList.remove('active');
            document.getElementById('game-container').classList.remove('hidden');
            document.getElementById('slots-section').style.display = 'none';
        }

        function backToMenu() {
            // Auto-save before returning to menu
            const lastSlot = localStorage.getItem('lastUsedSlot') || '1';
            saveGame(parseInt(lastSlot));
            showMainMenu();
        }

        function backToMainMenu() {
            document.getElementById('slots-section').style.display = 'none';
            document.getElementById('crates-section').classList.remove('active');
        }

        // Crate and Skin Functions
        function showCratesMenu() {
            document.getElementById('slots-section').style.display = 'none';
            document.getElementById('crates-section').classList.add('active');
            renderCratesMenu();
        }

        function calculateCrateCoins() {
            if (rebirths < 100) return 0;
            if (rebirths < 1000) return Math.floor(rebirths / 100);
            return Math.floor(rebirths / 1000);
        }

        function renderCratesMenu() {
            const cratesGrid = document.getElementById('crates-grid');
            cratesGrid.innerHTML = '';

            for (const crate of shovelCrates) {
                const crateDiv = document.createElement('div');
                crateDiv.className = 'crate-card';
                
                const now = Date.now();
                const lastOpenTime = lastCrateOpenTime[crate.id] || 0;
                const cooldownRemaining = Math.max(0, CRATE_COOLDOWN - (now - lastOpenTime));
                const isOnCooldown = cooldownRemaining > 0;
                const hasEnoughCoins = crateCoins >= crate.price;
                
                let buttonHTML = '';
                if (isOnCooldown) {
                    buttonHTML = `<button class="crate-btn" disabled style="opacity: 0.5;">‚è±Ô∏è ${Math.ceil(cooldownRemaining / 1000)}s</button>`;
                } else if (!hasEnoughCoins) {
                    buttonHTML = `<button class="crate-btn" disabled style="opacity: 0.5;">Need üéÅ${crate.price}</button>`;
                } else {
                    buttonHTML = `<button class="crate-btn" onclick="openCrate('${crate.id}')">Open (üéÅ${crate.price})</button>`;
                }
                
                crateDiv.innerHTML = `
                    <div class="crate-icon">${crate.icon}</div>
                    <div class="crate-name">${crate.name}</div>
                    <div class="crate-desc">${crate.description}</div>
                    <div class="crate-price">üéÅ ${crate.price} coins</div>
                    ${buttonHTML}
                `;
                cratesGrid.appendChild(crateDiv);
            }
        }

        function selectRandomSkin(crate) {
            // Weighted random selection based on rarity
            // Legendaries: 5% (very rare)
            // Epic: 10% (rare)
            // Rare: 15% (uncommon)
            // Common: 70% (most common - least rare)
            
            const rand = Math.random();
            const legendary = crate.skins.filter(s => s.rarity === 'legendary');
            const epic = crate.skins.filter(s => s.rarity === 'epic');
            const rare = crate.skins.filter(s => s.rarity === 'rare');
            const common = crate.skins.filter(s => s.rarity === 'common');
            
            if (rand < 0.05 && legendary.length > 0) {
                return legendary[Math.floor(Math.random() * legendary.length)];
            } else if (rand < 0.15 && epic.length > 0) {
                return epic[Math.floor(Math.random() * epic.length)];
            } else if (rand < 0.30 && rare.length > 0) {
                return rare[Math.floor(Math.random() * rare.length)];
            } else {
                return common[Math.floor(Math.random() * common.length)];
            }
        }

        function openCrate(crateId) {
            const crate = shovelCrates.find(c => c.id === crateId);
            if (!crate) return;

            // Check cooldown
            const now = Date.now();
            const lastOpenTime = lastCrateOpenTime[crateId] || 0;
            if (now - lastOpenTime < CRATE_COOLDOWN) {
                alert('‚è±Ô∏è This crate is still cooling down!');
                return;
            }

            // Check coins
            if (crateCoins < crate.price) {
                alert(`‚ùå You need üéÅ${crate.price} coins! You only have üéÅ${crateCoins}`);
                return;
            }

            // Deduct coins
            crateCoins -= crate.price;
            try {
                localStorage.setItem('crateCoins', crateCoins.toString());
            } catch (e) {
                console.error('Failed to save crate coins:', e);
            }

            // Set cooldown
            lastCrateOpenTime[crateId] = now;

            // Get a random skin based on weighted rarity
            const randomSkin = selectRandomSkin(crate);
            
            // Add to owned skins
            ownedSkins[randomSkin.id] = true;

            // Show reveal modal
            const modal = document.getElementById('skin-reveal-modal');
            document.getElementById('rarity-banner').className = `skin-rarity ${randomSkin.rarity}`;
            document.getElementById('rarity-banner').textContent = randomSkin.rarity.toUpperCase();
            document.getElementById('skin-emoji-display').textContent = randomSkin.emoji;
            document.getElementById('skin-name-display').textContent = randomSkin.name;
            
            modal.classList.add('active');

            // Update display
            updateDisplay();
            renderCratesMenu();

            // Save the new skin to localStorage
            try {
                localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins));
            } catch (e) {
                console.error('Failed to save skins:', e);
            }
        }

        function closeSkinReveal() {
            document.getElementById('skin-reveal-modal').classList.remove('active');
        }

        function openSkinsModal() {
            document.getElementById('skins-modal').classList.add('active');
            renderSkinsCollection();
        }

        function closeSkinsModal() {
            document.getElementById('skins-modal').classList.remove('active');
        }

        function openSkinShop() {
            document.getElementById('skin-shop-modal').classList.add('active');
            renderSkinShop();
        }

        function closeSkinShop() {
            document.getElementById('skin-shop-modal').classList.remove('active');
        }

        function renderSkinShop() {
            const shopGrid = document.getElementById('skin-shop-grid');
            shopGrid.innerHTML = '';
            
            // Show current crate coins
            document.getElementById('shop-coins-display').textContent = crateCoins;

            // Display all skins with buy buttons
            for (const crate of shovelCrates) {
                for (const skin of crate.skins) {
                    // Determine price based on rarity
                    let skinPrice = 1;
                    if (skin.rarity === 'legendary') skinPrice = 5;
                    else if (skin.rarity === 'epic') skinPrice = 3;
                    else if (skin.rarity === 'rare') skinPrice = 2;
                    
                    const skinDiv = document.createElement('div');
                    skinDiv.className = `skin-card ${ownedSkins[skin.id] ? 'owned' : ''}`;
                    
                    if (ownedSkins[skin.id]) {
                        // Already owned
                        skinDiv.innerHTML = `
                            <div style="font-size: 30px;">${skin.emoji}</div>
                            <div style="color: white; font-size: 11px; margin-top: 8px; line-height: 1.2;">${skin.name}</div>
                            <div class="skin-rarity-badge ${skin.rarity}">${skin.rarity.toUpperCase()}</div>
                            <button class="crate-btn" style="margin-top: 8px; font-size: 11px;" onclick="selectSkinFromShop('${skin.id}')">Select</button>
                        `;
                    } else {
                        // Not owned - show buy button
                        const canAfford = crateCoins >= skinPrice;
                        skinDiv.innerHTML = `
                            <div style="font-size: 30px; opacity: 0.5;">${skin.emoji}</div>
                            <div style="color: white; font-size: 11px; margin-top: 8px; line-height: 1.2;">${skin.name}</div>
                            <div class="skin-rarity-badge ${skin.rarity}">${skin.rarity.toUpperCase()}</div>
                            <button class="crate-btn" style="margin-top: 8px; font-size: 11px; ${!canAfford ? 'opacity: 0.5;' : ''}" ${!canAfford ? 'disabled' : ''} onclick="buySkinFromShop('${skin.id}', ${skinPrice})">Buy üéÅ${skinPrice}</button>
                        `;
                    }
                    
                    shopGrid.appendChild(skinDiv);
                }
            }
        }

        function buySkinFromShop(skinId, price) {
            if (crateCoins < price) {
                alert(`‚ùå You need üéÅ${price} coins! You only have üéÅ${crateCoins}`);
                return;
            }

            // Deduct coins and add skin
            crateCoins -= price;
            ownedSkins[skinId] = true;

            // Save
            try {
                localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins));
            } catch (e) {
                console.error('Failed to save skins:', e);
            }

            alert('‚ú® Skin purchased!');
            renderSkinShop();
            updateDisplay();
        }

        function selectSkinFromShop(skinId) {
            selectSkin(skinId);
            closeSkinShop();
        }

        function renderSkinsCollection() {
            const skinsGrid = document.getElementById('skins-grid');
            skinsGrid.innerHTML = '';

            // Add default skin first
            const defaultSkinDiv = document.createElement('div');
            defaultSkinDiv.className = `skin-card ${selectedSkin === 'default' ? 'selected' : ''} owned`;
            defaultSkinDiv.innerHTML = `
                <div style="font-size: 30px;">‚õèÔ∏è</div>
                <div style="color: white; font-size: 12px; margin-top: 8px;">Default</div>
                <div class="skin-rarity-badge common">COMMON</div>
            `;
            defaultSkinDiv.onclick = () => selectSkin('default');
            skinsGrid.appendChild(defaultSkinDiv);

            // Add all crates' skins
            for (const crate of shovelCrates) {
                for (const skin of crate.skins) {
                    if (ownedSkins[skin.id]) {
                        const skinDiv = document.createElement('div');
                        skinDiv.className = `skin-card ${selectedSkin === skin.id ? 'selected' : ''} owned`;
                        skinDiv.innerHTML = `
                            <div style="font-size: 30px;">${skin.emoji}</div>
                            <div style="color: white; font-size: 11px; margin-top: 8px; line-height: 1.2;">${skin.name}</div>
                            <div class="skin-rarity-badge ${skin.rarity}">${skin.rarity.toUpperCase()}</div>
                        `;
                        skinDiv.onclick = () => selectSkin(skin.id);
                        skinsGrid.appendChild(skinDiv);
                    }
                }
            }
        }

        function selectSkin(skinId) {
            selectedSkin = skinId;
            renderSkinsCollection();
            updateShovelEmoji();
            
            // Save selected skin
            try {
                localStorage.setItem('selectedSkin', skinId);
            } catch (e) {
                console.error('Failed to save selected skin:', e);
            }
        }

        function updateShovelEmoji() {
            let emoji = '‚õèÔ∏è'; // default
            
            if (selectedSkin !== 'default') {
                for (const crate of shovelCrates) {
                    const skin = crate.skins.find(s => s.id === selectedSkin);
                    if (skin) {
                        emoji = skin.emoji;
                        break;
                    }
                }
            }
            
            const shovel = document.getElementById('shovel');
            if (shovel) {
                shovel.textContent = emoji;
            }
        }

        function openMenuSettings() {
            document.getElementById('menu-settings-modal').classList.add('active');
        }

        function closeMenuSettings() {
            document.getElementById('menu-settings-modal').classList.remove('active');
        }

        function openGameSettings() {
            document.getElementById('settings-modal').classList.add('active');
            document.getElementById('settings-coins-display').textContent = crateCoins;
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.remove('active');
        }

        function openSettings() {
            openGameSettings();
        }

        function resetAllProgressFromMenu() {
            if (confirm('This will PERMANENTLY delete ALL save slots! Are you absolutely sure?')) {
                if (confirm('Last chance! Click OK to delete EVERYTHING!')) {
                    try {
                        for (let i = 1; i <= 3; i++) {
                            localStorage.removeItem(`diggingGameSave_${i}`);
                        }
                        localStorage.removeItem('lastUsedSlot');
                        alert('‚úÖ All saves deleted!');
                        closeMenuSettings();
                    } catch (e) {
                        alert('Failed to delete saves: ' + e.message);
                    }
                }
            }
        }
        
        // Refresh crate menu every 1 second if visible to show cooldown timers
        setInterval(() => {
            const cratesSection = document.getElementById('crates-section');
            if (cratesSection && cratesSection.classList.contains('active')) {
                renderCratesMenu();
            }
        }, 1000);
        
        // Auto-save every 30 seconds
        setInterval(() => {
            const saveData = {
                money: money,
                depth: depth,
                rebirths: rebirths,
                currentWorld: currentWorld,
                chosenPath: chosenPath,
                pathProgress: pathProgress,
                workerCounts: workerCounts,
                upgrades: {},
                timestamp: new Date().toISOString()
            };
            
            for (const [key, upgrade] of Object.entries(upgrades)) {
                saveData.upgrades[key] = upgrade.level;
            }
            
            try {
                const lastSlot = localStorage.getItem('lastUsedSlot') || '1';
                localStorage.setItem(`diggingGameSave_${lastSlot}`, JSON.stringify(saveData));
                console.log('Auto-saved to slot ' + lastSlot);
            } catch (e) {
                console.error('Auto-save failed:', e);
            }
        }, 30000);

        // Initialize game
        init();
    </script>
</body>
</html>

67